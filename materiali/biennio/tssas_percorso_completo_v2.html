<!DOCTYPE html>
<html lang="it">
<head>
    <meta name="page-id" content="attivita-materiali-biennio-tssas-percorso-completo-v2">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSSAS - Percorso Interattivo Gamificato</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-turchese: #1DD3D3;
            --color-lime: #C6E716;
            --color-fucsia: #FF0090;
            --color-turchese-dark: #16A8A8;
            --color-lime-dark: #9CB912;
            --color-fucsia-dark: #CC0073;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--color-turchese) 0%, #16A8A8 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--color-turchese) 0%, var(--color-turchese-dark) 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* SCORE & PROGRESS SECTION */
        .score-section {
            background: linear-gradient(135deg, var(--color-lime) 0%, var(--color-lime-dark) 100%);
            padding: 25px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .score-box {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-width: 150px;
            transition: transform 0.3s;
        }

        .score-box:hover {
            transform: translateY(-5px);
        }

        .score-box .label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .score-box .value {
            font-size: 2.2em;
            font-weight: bold;
            color: var(--color-fucsia);
        }

        .score-box .max {
            font-size: 1em;
            color: #999;
        }

        /* PROGRESS BAR */
        .progress-container {
            background: rgba(255,255,255,0.3);
            padding: 25px;
            text-align: center;
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .progress-step {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            transition: all 0.4s;
            position: relative;
        }

        .progress-step.completed {
            background: var(--color-fucsia);
            box-shadow: 0 0 20px rgba(255, 0, 144, 0.5);
        }

        .progress-step.active {
            background: var(--color-lime);
            color: #333;
            transform: scale(1.3);
            box-shadow: 0 0 25px rgba(198, 231, 22, 0.7);
        }

        .progress-step::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 3px;
            background: rgba(255,255,255,0.3);
            right: -32px;
            top: 50%;
            transform: translateY(-50%);
        }

        .progress-step:last-child::after {
            display: none;
        }

        .progress-text {
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        /* BADGES */
        .badges-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .badge {
            background: white;
            padding: 12px 20px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            opacity: 0.4;
            transition: all 0.3s;
        }

        .badge.unlocked {
            opacity: 1;
            animation: badgeUnlock 0.6s ease-out;
        }

        @keyframes badgeUnlock {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0); }
        }

        .badge .emoji {
            font-size: 1.5em;
        }

        .badge .name {
            font-weight: bold;
            color: #333;
            font-size: 0.95em;
        }

        /* CONTENT */
        .content {
            padding: 40px;
        }

        .fase {
            display: none;
        }

        .fase.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fase h2 {
            color: var(--color-turchese);
            font-size: 2.2em;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .fase h2 .emoji {
            font-size: 1.2em;
        }

        /* INFO BOXES */
        .info-box {
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 6px solid;
        }

        .info-box h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box-blue {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            border-left-color: #2196F3;
        }

        .info-box-blue h3 {
            color: #1976D2;
        }

        .info-box-green {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            border-left-color: #4CAF50;
        }

        .info-box-green h3 {
            color: #388E3C;
        }

        .info-box-yellow {
            background: linear-gradient(135deg, #FFF9C4 0%, #FFF59D 100%);
            border-left-color: #FBC02D;
        }

        .info-box-yellow h3 {
            color: #F57F17;
        }

        .info-box-purple {
            background: linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 100%);
            border-left-color: #9C27B0;
        }

        .info-box-purple h3 {
            color: #7B1FA2;
        }

        .info-box-orange {
            background: linear-gradient(135deg, #FFE0B2 0%, #FFCC80 100%);
            border-left-color: #FF9800;
        }

        .info-box-orange h3 {
            color: #E65100;
        }

        .info-box-red {
            background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
            border-left-color: #F44336;
        }

        .info-box-red h3 {
            color: #C62828;
        }

        .info-box ul {
            list-style: none;
            padding-left: 0;
        }

        .info-box ul li {
            padding: 8px 0 8px 30px;
            position: relative;
        }

        .info-box ul li::before {
            content: "→";
            position: absolute;
            left: 0;
            font-weight: bold;
            color: inherit;
        }

        /* INPUT AREAS */
        .input-area {
            margin: 25px 0;
        }

        .input-area label {
            display: block;
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-area textarea {
            width: 100%;
            min-height: 140px;
            padding: 18px;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            transition: all 0.3s;
        }

        .input-area textarea:focus {
            outline: none;
            border-color: var(--color-turchese);
            box-shadow: 0 0 0 4px rgba(29, 211, 211, 0.1);
        }

        .input-area textarea.completed {
            border-color: var(--color-lime);
            background: rgba(198, 231, 22, 0.05);
        }

        .input-area input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .input-area input[type="text"]:focus {
            outline: none;
            border-color: var(--color-turchese);
            box-shadow: 0 0 0 4px rgba(29, 211, 211, 0.1);
        }

        /* QUIZ */
        .quiz-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .quiz-question {
            margin-bottom: 30px;
        }

        .quiz-question h4 {
            color: var(--color-turchese);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quiz-option {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quiz-option:hover {
            border-color: var(--color-turchese);
            background: rgba(29, 211, 211, 0.05);
        }

        .quiz-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .quiz-option label {
            cursor: pointer;
            flex: 1;
            font-size: 1em;
        }

        .quiz-option.correct {
            background: rgba(76, 175, 80, 0.1);
            border-color: #4CAF50;
        }

        .quiz-option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: #F44336;
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: rgba(76, 175, 80, 0.15);
            color: #2E7D32;
            border-left: 4px solid #4CAF50;
        }

        .quiz-feedback.incorrect {
            background: rgba(244, 67, 54, 0.15);
            color: #C62828;
            border-left: 4px solid #F44336;
        }

        /* BUTTONS */
        .button {
            background: linear-gradient(135deg, var(--color-fucsia) 0%, var(--color-fucsia-dark) 100%);
            color: white;
            border: none;
            padding: 16px 35px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(255, 0, 144, 0.3);
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 0, 144, 0.5);
        }

        .button:active {
            transform: translateY(-1px);
        }

        .button-secondary {
            background: linear-gradient(135deg, var(--color-turchese) 0%, var(--color-turchese-dark) 100%);
            box-shadow: 0 6px 20px rgba(29, 211, 211, 0.3);
        }

        .button-secondary:hover {
            box-shadow: 0 8px 25px rgba(29, 211, 211, 0.5);
        }

        .button-success {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }

        .button-success:hover {
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
        }

        .button-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* CARDS */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            border-left: 5px solid var(--color-turchese);
        }

        .card h4 {
            color: var(--color-turchese);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .card p {
            margin: 10px 0;
            line-height: 1.7;
        }

        /* GRID */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 25px 0;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 25px;
            }

            .score-section {
                flex-direction: column;
            }
        }

        /* HIGHLIGHT */
        .highlight {
            background: var(--color-lime);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #333;
        }

        /* POINTS POPUP */
        .points-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            transition: transform 0.3s ease-out;
        }

        .points-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .points-popup .points-value {
            font-size: 3em;
            font-weight: bold;
            color: var(--color-fucsia);
            margin: 20px 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* AUTOVALUTAZIONE */
        .autovalutazione-grid {
            display: grid;
            gap: 20px;
            margin: 25px 0;
        }

        .competenza-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--color-turchese);
        }

        .competenza-item label {
            display: block;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }

        .scala-valutazione {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }

        .scala-valutazione input[type="radio"] {
            display: none;
        }

        .scala-valutazione label {
            flex: 1;
            text-align: center;
            padding: 12px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: normal;
        }

        .scala-valutazione input[type="radio"]:checked + label {
            background: var(--color-lime);
            border-color: var(--color-lime-dark);
            color: #333;
            font-weight: bold;
        }

        .scala-valutazione label:hover {
            border-color: var(--color-turchese);
        }

        /* PRINT STYLES */
        @media print {
            body {
                background: white;
            }

            .score-section,
            .progress-container,
            .button-container,
            .overlay,
            .points-popup {
                display: none !important;
            }

            .fase {
                display: block !important;
                page-break-after: always;
            }

            .container {
                box-shadow: none;
            }
        }

        /* CHALLENGE BOX */
        .challenge-box {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            border: 3px dashed #FF9800;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .challenge-box h4 {
            color: #E65100;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
        }

        .challenge-box .bonus-points {
            display: inline-block;
            background: var(--color-lime);
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <div class="points-popup" id="pointsPopup">
        <div style="font-size: 3em;">🎉</div>
        <div class="points-value" id="pointsValue">+15</div>
        <p style="font-size: 1.2em; color: #666;">Punti guadagnati!</p>
    </div>

    <div class="state-storage" style="display: none;" aria-hidden="true">
        <input type="hidden" id="stateTotalScore" name="stateTotalScore" value="0">
        <input type="hidden" id="stateCurrentPhase" name="stateCurrentPhase" value="1">
        <input type="hidden" id="stateCompletedTextareas" name="stateCompletedTextareas" value="[]">
        <input type="hidden" id="stateUnlockedBadges" name="stateUnlockedBadges" value="[]">
        <input type="hidden" id="stateQuizScores" name="stateQuizScores" value="{}">
    </div>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>🎓 Il Tecnico dei Servizi per la Sanità e l'Assistenza Sociale</h1>
            <p>Percorso Interattivo Gamificato - Modello a 6 Fasi Progressive</p>
        </div>

        <!-- SCORE SECTION -->
        <div class="score-section">
            <div class="score-box">
                <div class="label">PUNTI TOTALI</div>
                <div class="value"><span id="currentScore">0</span><span class="max">/290</span></div>
            </div>
            <div class="score-box">
                <div class="label">FASE ATTUALE</div>
                <div class="value"><span id="currentPhase">1</span><span class="max">/6</span></div>
            </div>
            <div class="score-box">
                <div class="label">BADGE SBLOCCATI</div>
                <div class="value"><span id="badgeCount">0</span><span class="max">/6</span></div>
            </div>
        </div>

        <!-- PROGRESS BAR -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-step active" id="step1">1</div>
                <div class="progress-step" id="step2">2</div>
                <div class="progress-step" id="step3">2.5</div>
                <div class="progress-step" id="step4">3</div>
                <div class="progress-step" id="step5">4</div>
                <div class="progress-step" id="step6">5</div>
            </div>
            <div class="progress-text" id="progressText">Fase 1: Attivazione - Scopri il TSSAS</div>
            
            <div class="badges-container">
                <div class="badge" id="badge1">
                    <span class="emoji">🎯</span>
                    <span class="name">Esploratore</span>
                </div>
                <div class="badge" id="badge2">
                    <span class="emoji">📚</span>
                    <span class="name">Studioso</span>
                </div>
                <div class="badge" id="badge3">
                    <span class="emoji">🔍</span>
                    <span class="name">Analista</span>
                </div>
                <div class="badge" id="badge4">
                    <span class="emoji">🎨</span>
                    <span class="name">Sperimentatore</span>
                </div>
                <div class="badge" id="badge5">
                    <span class="emoji">💡</span>
                    <span class="name">Pensatore</span>
                </div>
                <div class="badge" id="badge6">
                    <span class="emoji">🏆</span>
                    <span class="name">Maestro TSSAS</span>
                </div>
            </div>
        </div>

        <!-- CONTENT -->
        <div class="content">
            <!-- FASE 1: ATTIVAZIONE -->
            <div class="fase active" id="fase1">
                <h2><span class="emoji">🎯</span> FASE 1: ATTIVAZIONE - Scopri cos'è il TSSAS</h2>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⏱️</span> Cosa fai ora (5 minuti)</h3>
                    <ul>
                        <li>Attiva le tue conoscenze pregresse sul tema</li>
                        <li>Scrivi liberamente cosa sai già sul TSSAS</li>
                        <li>Guarda il video introduttivo (opzionale)</li>
                        <li>Rifletti sulla domanda-stimolo finale</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">💡</span> Perché lo fai</h3>
                    <p><strong>Attivare le conoscenze pregresse</strong> rende l'apprendimento più efficace! Partire da ciò che già sai ti permette di costruire connessioni significative con i nuovi contenuti.</p>
                </div>

                <div class="input-area">
                    <label>✍️ BRAINSTORMING INIZIALE (15 punti)</label>
                    <p style="margin-bottom: 10px; color: #666; font-size: 0.95em;">Prima di studiare la teoria, scrivi tutto quello che pensi di sapere sul Tecnico dei Servizi Socio-Sanitari:</p>
                    <textarea 
                        id="brainstorming-iniziale" 
                        data-points="15"
                        placeholder="• Cosa fa secondo te un TSSAS?
• Dove immagini che lavori?
• Con quali persone interagisce?
• Quali competenze pensi servano?
• Hai mai sentito parlare di questa figura? Dove?

Scrivi liberamente, senza preoccuparti di essere preciso - questa è la tua base di partenza!" name="brainstorming-iniziale"></textarea>
                </div>

                <div class="card">
                    <h4>🎥 VIDEO INTRODUTTIVO (Opzionale)</h4>
                    <p style="color: #666; margin-bottom: 15px;">Prima di proseguire, guarda questo breve video che introduce la figura del TSSAS nel contesto socio-sanitario italiano:</p>
                    <div style="background: #f5f5f5; padding: 30px; text-align: center; border-radius: 10px;">
                        <p style="color: #999;">📹 [Qui verrà inserito il link al video introduttivo]</p>
                        <p style="color: #999; font-size: 0.9em; margin-top: 10px;">Oppure cerca su YouTube: "Tecnico Servizi Socio Sanitari testimonianza"</p>
                    </div>
                </div>

                <div class="input-area">
                    <label>🤔 DOMANDA-STIMOLO (5 punti)</label>
                    <p style="margin-bottom: 10px; color: #666; font-size: 0.95em;">Dopo il brainstorming (e l'eventuale video), rifletti:</p>
                    <textarea 
                        id="domanda-stimolo-1" 
                        data-points="5"
                        placeholder="Quali domande ti poni ora sul ruolo del TSSAS? Cosa vorresti approfondire? Cosa ti incuriosisce di più di questa professione?" name="domanda-stimolo-1"></textarea>
                </div>

                <div class="button-container">
                    <button class="button" onclick="completePhase(1, 2)">
                        ✅ Completato! → Vai alla Fase 2
                    </button>
                </div>
            </div>

            <!-- FASE 2: ESPLORAZIONE -->
            <div class="fase" id="fase2">
                <h2><span class="emoji">📚</span> FASE 2: ESPLORAZIONE - Costruisci le basi teoriche</h2>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⏱️</span> Cosa fai ora (20 minuti)</h3>
                    <ul>
                        <li>Leggi attentamente i contenuti teorici negli info-box</li>
                        <li>Studia il modello bio-psico-sociale</li>
                        <li>Scopri le competenze chiave del TSSAS</li>
                        <li>Completa il quiz di comprensione</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">💡</span> Perché lo fai</h3>
                    <p><strong>Costruire solide basi teoriche</strong> è fondamentale per comprendere il tuo futuro ruolo professionale. Ogni concetto che apprendi ora sarà utile nella pratica!</p>
                </div>

                <!-- CONTENUTI TEORICI -->
                <div class="info-box info-box-blue">
                    <h3><span class="emoji">📖</span> CHI È IL TSSAS - Definizione ufficiale</h3>
                    <p>Il <span class="highlight">Tecnico dei Servizi per la Sanità e l'Assistenza Sociale (TSSAS)</span> è la figura professionale che lavora come <strong>soggetto portatore di diritti e di doveri</strong>, parte del <span class="highlight">modello sistemico bio-psico-sociale</span>.</p>
                    <p style="margin-top: 15px;">È un <strong>professionista della relazione d'aiuto</strong> che opera con persone di diverse età (individui e gruppi) per sostenere e potenziare la loro capacità di crescita personale e partecipazione sociale.</p>
                </div>

                <div class="info-box info-box-blue">
                    <h3><span class="emoji">🔬</span> IL MODELLO BIO-PSICO-SOCIALE</h3>
                    <p>È un metodo organizzativo di assistenza dove ogni situazione di salute o malattia è vista come la conseguenza dell'interazione di <strong>tre fattori fondamentali</strong>:</p>
                    <ul style="margin-top: 15px;">
                        <li><strong>BIOLOGICO</strong> → Gli aspetti fisici e corporei della persona (salute, malattia, funzionalità fisica)</li>
                        <li><strong>PSICOLOGICO</strong> → Gli aspetti mentali, emotivi e cognitivi (pensieri, emozioni, comportamenti)</li>
                        <li><strong>SOCIALE</strong> → Il contesto relazionale e ambientale (famiglia, comunità, cultura, risorse)</li>
                    </ul>
                    <p style="margin-top: 15px; background: rgba(255,255,255,0.7); padding: 15px; border-radius: 8px;">
                        <strong>💡 Esempio pratico:</strong> Un anziano con difficoltà motorie (biologico) può sviluppare depressione (psicologico) a causa dell'isolamento sociale (sociale). Il TSSAS deve considerare tutti e tre gli aspetti per un intervento efficace!
                    </p>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">🎯</span> LE COMPETENZE DEL TSSAS</h3>
                    <p>Il TSSAS deve acquisire competenze specifiche per:</p>
                    <ul style="margin-top: 15px;">
                        <li><strong>Organizzare e attuare</strong> interventi per rispondere alle esigenze sociali e sanitarie delle persone</li>
                        <li><strong>Promuovere</strong> il benessere bio-psico-sociale negli ambiti dell'assistenza e della salute</li>
                        <li><strong>Collaborare</strong> nella gestione di progetti e attività dei servizi sociali</li>
                        <li><strong>Facilitare</strong> la comunicazione tra persone e gruppi, anche con difficoltà comunicative</li>
                        <li><strong>Realizzare</strong> attività educative e di animazione sociale</li>
                        <li><strong>Raccogliere, conservare ed elaborare</strong> dati relativi alle attività professionali</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">🌍</span> DOVE LAVORA IL TSSAS - Contesti operativi</h3>
                    <ul>
                        <li><strong>Istituzioni pubbliche e private</strong> del settore socio-sanitario</li>
                        <li><strong>RSA (Residenze Sanitarie Assistenziali)</strong> per anziani</li>
                        <li><strong>Servizi sociali territoriali</strong> dei Comuni</li>
                        <li><strong>Strutture residenziali e semiresidenziali</strong> per diverse tipologie di utenza</li>
                        <li><strong>Centri diurni</strong> (per anziani, disabili, minori)</li>
                        <li><strong>Servizi di assistenza domiciliare</strong></li>
                        <li><strong>Comunità educative e terapeutiche</strong></li>
                        <li><strong>Progetti di educazione e animazione sociale</strong> sul territorio</li>
                    </ul>
                </div>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⚠️</span> IL LAVORO DI RETE - Competenza fondamentale</h3>
                    <p>Il TSSAS non lavora mai da solo! Il <span class="highlight">lavoro di rete</span> significa <strong>creare collegamenti e sinergie</strong> tra diverse risorse, formali e informali:</p>
                    <ul style="margin-top: 15px;">
                        <li><strong>Con le persone:</strong> attivando la presa in carico e coinvolgendo l'utente come protagonista</li>
                        <li><strong>Nel servizio e tra i servizi:</strong> collaborando con altri professionisti (assistenti sociali, educatori, infermieri, psicologi)</li>
                        <li><strong>Sul territorio:</strong> creando sinergie tra servizi pubblici, privato sociale e terzo settore</li>
                    </ul>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 8px;">
                            <strong>🤝 RETI INFORMALI</strong>
                            <ul style="margin-top: 10px; font-size: 0.95em;">
                                <li>Famiglia e parenti</li>
                                <li>Amici e vicini</li>
                                <li>Volontari</li>
                                <li>Associazioni</li>
                                <li>Gruppi religiosi</li>
                            </ul>
                        </div>
                        <div style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 8px;">
                            <strong>🏥 RETI FORMALI</strong>
                            <ul style="margin-top: 10px; font-size: 0.95em;">
                                <li>Servizio Sanitario Nazionale</li>
                                <li>Servizi sociali comunali</li>
                                <li>Scuole</li>
                                <li>Centri specialistici</li>
                                <li>Cooperative sociali</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- QUIZ FASE 2 -->
                <div class="quiz-container">
                    <h3 style="color: var(--color-fucsia); margin-bottom: 25px; font-size: 1.5em;">📝 QUIZ DI COMPRENSIONE (25 punti)</h3>
                    <p style="margin-bottom: 25px; color: #666;">Verifica di aver compreso i concetti chiave! Ogni risposta corretta vale punti.</p>

                    <!-- Domanda 1 -->
                    <div class="quiz-question">
                        <h4>1. Il modello bio-psico-sociale considera:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_1')">
                                <input type="radio" name="q2_1" id="q2_1_a">
                                <label for="q2_1_a">Solo gli aspetti biologici e fisici della persona</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'q2_1')">
                                <input type="radio" name="q2_1" id="q2_1_b">
                                <label for="q2_1_b">L'interazione tra aspetti biologici, psicologici e sociali</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_1')">
                                <input type="radio" name="q2_1" id="q2_1_c">
                                <label for="q2_1_c">Principalmente il contesto sociale della persona</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_1')">
                                <input type="radio" name="q2_1" id="q2_1_d">
                                <label for="q2_1_d">Solo gli aspetti psicologici ed emotivi</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_q2_1"></div>
                    </div>

                    <!-- Domanda 2 -->
                    <div class="quiz-question">
                        <h4>2. Quale tra queste NON è una competenza del TSSAS?</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_2')">
                                <input type="radio" name="q2_2" id="q2_2_a">
                                <label for="q2_2_a">Organizzare interventi socio-sanitari</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'q2_2')">
                                <input type="radio" name="q2_2" id="q2_2_b">
                                <label for="q2_2_b">Prescrivere farmaci e terapie mediche</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_2')">
                                <input type="radio" name="q2_2" id="q2_2_c">
                                <label for="q2_2_c">Facilitare la comunicazione tra persone e gruppi</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_2')">
                                <input type="radio" name="q2_2" id="q2_2_d">
                                <label for="q2_2_d">Realizzare attività di animazione sociale</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_q2_2"></div>
                    </div>

                    <!-- Domanda 3 -->
                    <div class="quiz-question">
                        <h4>3. Il "lavoro di rete" nel contesto del TSSAS significa:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_3')">
                                <input type="radio" name="q2_3" id="q2_3_a">
                                <label for="q2_3_a">Utilizzare principalmente internet e i social media</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_3')">
                                <input type="radio" name="q2_3" id="q2_3_b">
                                <label for="q2_3_b">Lavorare esclusivamente con i servizi formali pubblici</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'q2_3')">
                                <input type="radio" name="q2_3" id="q2_3_c">
                                <label for="q2_3_c">Creare collegamenti tra risorse formali e informali del territorio</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_3')">
                                <input type="radio" name="q2_3" id="q2_3_d">
                                <label for="q2_3_d">Lavorare solo con la famiglia dell'utente</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_q2_3"></div>
                    </div>

                    <!-- Domanda 4 -->
                    <div class="quiz-question">
                        <h4>4. Un esempio di rete informale è:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_4')">
                                <input type="radio" name="q2_4" id="q2_4_a">
                                <label for="q2_4_a">Il Servizio Sanitario Nazionale</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'q2_4')">
                                <input type="radio" name="q2_4" id="q2_4_b">
                                <label for="q2_4_b">I vicini di casa e il gruppo di volontari del quartiere</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_4')">
                                <input type="radio" name="q2_4" id="q2_4_c">
                                <label for="q2_4_c">I servizi sociali del Comune</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_4')">
                                <input type="radio" name="q2_4" id="q2_4_d">
                                <label for="q2_4_d">Una cooperativa sociale accreditata</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_q2_4"></div>
                    </div>

                    <!-- Domanda 5 -->
                    <div class="quiz-question">
                        <h4>5. Il TSSAS è definito come "professionista della relazione d'aiuto" perché:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_5')">
                                <input type="radio" name="q2_5" id="q2_5_a">
                                <label for="q2_5_a">Fornisce aiuti economici alle persone in difficoltà</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'q2_5')">
                                <input type="radio" name="q2_5" id="q2_5_b">
                                <label for="q2_5_b">Sostiene le persone nel loro percorso di crescita e partecipazione sociale</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_5')">
                                <input type="radio" name="q2_5" id="q2_5_c">
                                <label for="q2_5_c">Si occupa solo di assistenza fisica e infermieristica</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'q2_5')">
                                <input type="radio" name="q2_5" id="q2_5_d">
                                <label for="q2_5_d">Lavora esclusivamente in ambito ospedaliero</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_q2_5"></div>
                    </div>
                </div>

                <div class="button-container">
                    <button class="button button-secondary" onclick="goToPhase(1)">
                        ← Torna alla Fase 1
                    </button>
                    <button class="button" onclick="completePhase(2, 3)">
                        ✅ Completato! → Vai alla Fase 2.5
                    </button>
                </div>
            </div>

            <!-- FASE 2.5: APPROFONDIMENTO CRITICO -->
            <div class="fase" id="fase3">
                <h2><span class="emoji">🔍</span> FASE 2.5: APPROFONDIMENTO CRITICO - Le tipologie di utenza</h2>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⏱️</span> Cosa fai ora (15 minuti)</h3>
                    <ul>
                        <li>Esplora le diverse tipologie di utenti dei servizi socio-sanitari</li>
                        <li>Analizza i bisogni specifici di ciascuna categoria</li>
                        <li>Rifletti sulle sfide e le criticità dell'intervento</li>
                        <li>Completa l'esercizio di analisi critica</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">💡</span> Perché lo fai</h3>
                    <p><strong>Conoscere l'utenza</strong> è fondamentale per il tuo lavoro! Ogni categoria ha bisogni specifici che richiedono approcci diversi. Sviluppare uno sguardo critico ti prepara alle sfide reali della professione.</p>
                </div>

                <h3 style="color: var(--color-turchese); margin: 30px 0 20px;">👥 LE TIPOLOGIE DI UTENZA NEI SERVIZI</h3>

                <div class="card">
                    <h4>🎯 CHI SONO GLI UTENTI</h4>
                    <p><strong>Gli utenti</strong> sono persone che usufruiscono di un servizio, portatrici di valori fondamentali come la <span class="highlight">libertà di agire</span>, il rispetto degli altri e la <span class="highlight">responsabilità</span> vista come <span class="highlight">consapevolezza delle proprie azioni</span>.</p>
                    <p style="margin-top: 15px;">Come TSSAS, eserciterai una <strong>professione in stretta relazione con gli utenti</strong>, attivando un percorso educativo che conduca all'assunzione delle loro responsabilità e consapevolezza.</p>
                    <div style="background: rgba(29, 211, 211, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid var(--color-turchese);">
                        <p><strong>💡 Relazione d'aiuto:</strong> percorso basato su intenti comuni, condivisione dell'interesse e presa in carico dei problemi per favorire il cambiamento. Il tuo ruolo sarà <strong>fare emergere i potenziali e le abilità sociali e personali</strong> (life skills) per incentivare l'autogestione e il ruolo attivo.</p>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h4>👨‍👩‍👧‍👦 LA FAMIGLIA</h4>
                        <p><strong>Definizione:</strong> Istituzione di base della società, composta da genitori e prole (famiglia nucleare).</p>
                        <p style="margin-top: 10px;"><strong>Situazione oggi:</strong> Le famiglie italiane hanno un <span class="highlight">basso numero di componenti</span>, con nuove forme:</p>
                        <ul style="margin-top: 10px;">
                            <li>Famiglie di single</li>
                            <li>Famiglie ricostituite</li>
                            <li>Convivenze senza matrimonio</li>
                            <li>Famiglie arcobaleno</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Obiettivo:</strong> garantire la sopravvivenza, lo sviluppo e il sostegno di ciascuno dei suoi membri.</p>
                        <div style="background: #FFF3E0; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <strong>⚠️ Problemi attuali:</strong> fragilità dell'istituzione, flessione del mercato del lavoro, allungamento della vita, bisogno di assistenza degli anziani.
                        </div>
                    </div>

                    <div class="card">
                        <h4>👶 L'INFANZIA (0-10 anni)</h4>
                        <p><strong>Prima infanzia (0-3 anni):</strong> Totale dipendenza dai genitori</p>
                        <p style="margin-top: 10px;"><strong>Seconda infanzia (3-6 anni):</strong> Affermazione della personalità, interesse ai rapporti sociali</p>
                        <p style="margin-top: 10px;"><strong>Terza infanzia (6-10 anni):</strong> Scuola primaria</p>
                        <div style="background: #E8F5E9; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <strong>🧠 Sviluppi importanti:</strong>
                            <ul style="margin-top: 8px;">
                                <li>Percettivo-motorio: sistema nervoso e coordinazione</li>
                                <li>Linguistico: da balbettio a frasi complete</li>
                                <li>Affettivo-relazionale: legame con genitori e altri</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <h4>🧒 L'ADOLESCENZA (10-18 anni)</h4>
                        <p><strong>Fase di passaggio</strong> dall'infanzia all'età adulta, molto tormentata e critica.</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Pubertà (10-14 anni):</strong> cambiamenti corporei</li>
                            <li><strong>Adolescenza (fino a 18 anni)</strong></li>
                            <li><strong>Tarda adolescenza (fino a 25 anni):</strong> dipendenza economica prolungata</li>
                        </ul>
                        <div style="background: #FFEBEE; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <strong>⚠️ Crisi adolescenziale:</strong>
                            <ul style="margin-top: 8px;">
                                <li>Insofferenza verso adulti</li>
                                <li>Ribellione contro regole</li>
                                <li>Difficoltà ad abbandonare il sé infantile</li>
                                <li>Rischio di disadattamento</li>
                            </ul>
                        </div>
                        <p style="margin-top: 10px;"><strong>🎯 Ruolo TSSAS:</strong> Prevenire conflitti, discutere regole, individualizzare interventi con realismo e umanità.</p>
                    </div>

                    <div class="card">
                        <h4>👴 LA TERZA ETÀ (65+ anni)</h4>
                        <p><strong>Nuova definizione:</strong> Non più solo "assenza di malattia" ma <span class="highlight">risorsa per la vita quotidiana e per la società</span>.</p>
                        <p style="margin-top: 10px;"><strong>Confine:</strong> oggi si sposta a 70 anni e oltre</p>
                        <div style="background: #E1F5FE; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <strong>📊 Le tre tappe della vita:</strong>
                            <ul style="margin-top: 8px;">
                                <li><strong>Sviluppo:</strong> nascita → età adulta</li>
                                <li><strong>Adultità:</strong> lavoro + responsabilità</li>
                                <li><strong>Senilità:</strong> età pensionabile in poi</li>
                            </ul>
                        </div>
                        <p style="margin-top: 10px;"><strong>⚠️ Sfide:</strong> involuzione fisica/mentale, malattie, difficoltà economica. <span class="highlight">L'anima non invecchia</span> e va mantenuta attiva!</p>
                    </div>

                    <div class="card">
                        <h4>♿ LA DISABILITÀ</h4>
                        <p><strong>Definizione OMS (ICF):</strong> La disabilità è conseguenza di una relazione complessa tra salute e fattori personali e ambientali.</p>
                        <div style="background: #F3E5F5; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <strong>🔍 Dimensioni ICF:</strong>
                            <ul style="margin-top: 8px;">
                                <li>Condizioni di salute</li>
                                <li>Attività (grado autonomia)</li>
                                <li>Partecipazione sociale</li>
                                <li>Fattori ambientali</li>
                                <li>Fattori personali</li>
                            </ul>
                        </div>
                        <p style="margin-top: 10px;"><strong>🎯 Obiettivo:</strong> <span class="highlight">Promozione di integrazione sociale</span>. Bisogno di amore, considerazione, gratificazione.</p>
                        <p style="margin-top: 10px;"><strong>📜 Legge 104/92:</strong> Certificazione per percorsi personalizzati.</p>
                    </div>

                    <div class="card">
                        <h4>🔗 LE DIPENDENZE</h4>
                        <p><strong>Definizione:</strong> Comportamento ripetitivo basato sul bisogno psicologico e/o fisico.</p>
                        <div style="background: #FFEBEE; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <strong>📋 Forme "classiche":</strong>
                            <ul style="margin-top: 8px;">
                                <li>Alcoldipendenza (~25% popolazione)</li>
                                <li>Tossicodipendenza (primo contatto ~14 anni)</li>
                                <li>Tabagismo (~25% fuma)</li>
                                <li>Farmacodipendenza</li>
                                <li>Eccessoressia (acquisti compulsivi)</li>
                            </ul>
                        </div>
                        <div style="background: #E8EAF6; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <strong>🌐 Nuove dipendenze:</strong>
                            <ul style="margin-top: 8px;">
                                <li>Nomofobia (paura senza cellulare)</li>
                                <li>Sovraccarico informazioni</li>
                                <li>Cyberpedofilia</li>
                                <li>Hikikomori (isolamento sociale)</li>
                                <li>Cyber-relation (relazioni virtuali)</li>
                            </ul>
                        </div>
                        <p style="margin-top: 10px;"><strong>🚫 Chi sviluppa dipendenza:</strong> non sopporta frustrazione, ricerca indipendenza assoluta, incapace di accettare quotidianità.</p>
                    </div>
                </div>

                <!-- ESERCIZIO CRITICO -->
                <div class="card" style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); margin-top: 30px;">
                    <h4 style="color: #E65100;">🤔 ESERCIZIO DI ANALISI CRITICA (15 punti)</h4>
                    <div class="input-area">
                        <label>1. Scegli UNA tipologia di utenza tra quelle studiate e analizza:</label>
                        <textarea 
                            id="analisi-critica-utenza" 
                            data-points="15"
                            placeholder="• Quale tipologia hai scelto?
• Quali sono i 3 bisogni principali di questa utenza secondo il modello bio-psico-sociale?
  - Bisogno BIOLOGICO: ...
  - Bisogno PSICOLOGICO: ...
  - Bisogno SOCIALE: ...
• Quali criticità/difficoltà può incontrare il TSSAS nel lavorare con questa utenza?
• Perché è importante il lavoro di rete per questa specifica tipologia?" name="analisi-critica-utenza"></textarea>
                    </div>
                </div>

                <div class="button-container">
                    <button class="button button-secondary" onclick="goToPhase(2)">
                        ← Torna alla Fase 2
                    </button>
                    <button class="button" onclick="completePhase(3, 4)">
                        ✅ Completato! → Vai alla Fase 3
                    </button>
                </div>
            </div>

            <!-- FASE 3: SPERIMENTAZIONE -->
            <div class="fase" id="fase4">
                <h2><span class="emoji">🎨</span> FASE 3: SPERIMENTAZIONE - Applica le conoscenze</h2>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⏱️</span> Cosa fai ora (25 minuti)</h3>
                    <ul>
                        <li>Analizza un caso studio reale</li>
                        <li>Applica il modello bio-psico-sociale step by step</li>
                        <li>Progetta un intervento guidato usando il template fornito</li>
                        <li>Sperimenta la tua creatività professionale</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">💡</span> Perché lo fai</h3>
                    <p><strong>La sperimentazione guidata</strong> ti permette di applicare la teoria a situazioni concrete! Utilizzare strumenti operativi strutturati ti prepara al lavoro reale nei servizi.</p>
                </div>

                <h3 style="color: var(--color-turchese); margin: 30px 0 20px;">📋 CASO STUDIO: Maria e la sua famiglia</h3>

                <div class="card" style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);">
                    <h4 style="color: #1976D2;">👨‍👩‍👧 IL CASO</h4>
                    <p><strong>Maria, 35 anni</strong>, madre single di due bambini: <strong>Luca (8 anni)</strong> e <strong>Sofia (5 anni)</strong>.</p>
                    <p style="margin-top: 15px;"><strong>SITUAZIONE ATTUALE:</strong></p>
                    <ul style="margin-top: 10px;">
                        <li>Maria ha perso il lavoro 6 mesi fa (era cameriera in un ristorante)</li>
                        <li>Vive in un piccolo appartamento in affitto, fatica a pagare le bollette</li>
                        <li>Il padre dei bambini non è presente e non contribuisce economicamente</li>
                        <li>Maria soffre di ansia e ha difficoltà a dormire</li>
                        <li>Luca ha iniziato ad avere problemi comportamentali a scuola (aggressività, difficoltà di concentrazione)</li>
                        <li>Sofia frequenta la scuola dell'infanzia, sembra più serena ma chiede spesso del papà</li>
                        <li>Maria ha pochi contatti sociali, i suoi genitori abitano lontano e possono aiutarla raramente</li>
                        <li>Si sente sola, stanca e ha paura di "non farcela"</li>
                    </ul>
                    <p style="margin-top: 15px; background: rgba(255,255,255,0.7); padding: 12px; border-radius: 8px;">
                        <strong>🎯 Il tuo compito:</strong> Come TSSAS del servizio sociale territoriale, sei stato incaricato di seguire questa famiglia. Devi analizzare la situazione e proporre un intervento strutturato.
                    </p>
                </div>

                <h3 style="color: var(--color-fucsia); margin: 30px 0 20px;">🛠️ ATTIVITÀ GUIDATA IN 3 STEP</h3>

                <!-- STEP 1 -->
                <div class="card">
                    <h4>📊 STEP 1: ANALISI BIO-PSICO-SOCIALE (12 punti)</h4>
                    <p style="margin-bottom: 15px;">Utilizza il template qui sotto per analizzare la situazione di Maria applicando il modello bio-psico-sociale:</p>
                    
                    <div class="input-area">
                        <label>🔬 DIMENSIONE BIOLOGICA</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Aspetti fisici e materiali (salute, condizioni abitative, risorse economiche, alimentazione...)</p>
                        <textarea 
                            id="step1-biologico" 
                            data-points="4"
                            placeholder="Esempio: Maria e i bambini vivono in un appartamento piccolo, difficoltà economiche per cibo e bollette, Maria ha disturbi del sonno legati allo stress..." name="step1-biologico"></textarea>
                    </div>

                    <div class="input-area">
                        <label>🧠 DIMENSIONE PSICOLOGICA</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Aspetti emotivi, cognitivi e comportamentali (emozioni, pensieri, autostima, comportamenti...)</p>
                        <textarea 
                            id="step1-psicologico" 
                            data-points="4"
                            placeholder="Esempio: Maria soffre di ansia, bassa autostima ('non ce la faccio'), Luca manifesta aggressività a scuola, Sofia cerca il padre assente..." name="step1-psicologico"></textarea>
                    </div>

                    <div class="input-area">
                        <label>🌍 DIMENSIONE SOCIALE</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Relazioni, reti di supporto, contesto sociale (famiglia, amici, servizi, comunità...)</p>
                        <textarea 
                            id="step1-sociale" 
                            data-points="4"
                            placeholder="Esempio: Maria è isolata socialmente, genitori lontani, padre bambini assente, poche amicizie, scuola segnala problemi di Luca..." name="step1-sociale"></textarea>
                    </div>
                </div>

                <!-- STEP 2 -->
                <div class="card">
                    <h4>🎯 STEP 2: IDENTIFICAZIONE OBIETTIVI DI INTERVENTO (12 punti)</h4>
                    <p style="margin-bottom: 15px;">Sulla base dell'analisi, individua 3 obiettivi prioritari (uno per ogni dimensione) che l'intervento del TSSAS dovrebbe raggiungere:</p>
                    
                    <div class="input-area">
                        <label>Obiettivo 1 - Area BIOLOGICA/MATERIALE</label>
                        <textarea 
                            id="step2-obiettivo1" 
                            data-points="4"
                            placeholder="Esempio: Garantire la sicurezza abitativa e alimentare della famiglia attraverso l'accesso a contributi economici e servizi di supporto materiale" name="step2-obiettivo1"></textarea>
                    </div>

                    <div class="input-area">
                        <label>Obiettivo 2 - Area PSICOLOGICA</label>
                        <textarea 
                            id="step2-obiettivo2" 
                            data-points="4"
                            placeholder="Esempio: Sostenere Maria nel recupero della propria autostima e nella gestione dell'ansia, supportare Luca nell'elaborazione delle emozioni legate alla separazione dei genitori" name="step2-obiettivo2"></textarea>
                    </div>

                    <div class="input-area">
                        <label>Obiettivo 3 - Area SOCIALE</label>
                        <textarea 
                            id="step2-obiettivo3" 
                            data-points="4"
                            placeholder="Esempio: Creare una rete di supporto attorno alla famiglia, favorire la socializzazione di Maria e l'integrazione scolastica di Luca" name="step2-obiettivo3"></textarea>
                    </div>
                </div>

                <!-- STEP 3 -->
                <div class="card">
                    <h4>🗺️ STEP 3: PROGETTAZIONE DEL LAVORO DI RETE (11 punti)</h4>
                    <p style="margin-bottom: 15px;">Il TSSAS non lavora mai da solo! Identifica le risorse formali e informali da attivare:</p>
                    
                    <div class="input-area">
                        <label>🤝 RETI INFORMALI da attivare</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Famiglia, amici, vicini, volontariato, associazioni...</p>
                        <textarea 
                            id="step3-reti-informali" 
                            data-points="5"
                            placeholder="Esempio:
• Contattare i nonni di Luca e Sofia per un supporto anche a distanza (videochiamate, visite)
• Coinvolgere eventuali vicini di casa per creare una rete di vicinato solidale
• Proporre a Maria di entrare in un gruppo di auto-aiuto per genitori single
• ..." name="step3-reti-informali"></textarea>
                    </div>

                    <div class="input-area">
                        <label>🏥 RETI FORMALI da attivare</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Servizi sociali, sanitari, educativi, centri per l'impiego...</p>
                        <textarea 
                            id="step3-reti-formali" 
                            data-points="6"
                            placeholder="Esempio:
• Servizi Sociali Comunali: per contributo economico emergenza e sostegno al reddito
• Centro per l'Impiego: per percorso di ricollocazione lavorativa di Maria
• Consultorio Familiare: per supporto psicologico a Maria
• Scuola di Luca: attivare sportello psicologico, incontri con insegnanti
• ASL - servizi di neuropsichiatria infantile: valutazione e supporto per Luca
• Servizio educativo territoriale: educatore domiciliare per supporto alla genitorialità
• ..." name="step3-reti-formali"></textarea>
                    </div>
                </div>

                <!-- SFIDA EXTRA -->
                <div class="challenge-box">
                    <h4><span class="emoji">🌟</span> SFIDA EXTRA - LIVELLO AVANZATO <span class="bonus-points">+10 punti</span></h4>
                    <p style="margin-bottom: 15px;">Vuoi metterti alla prova? Completa questo compito opzionale per ottenere punti bonus!</p>
                    
                    <div class="input-area">
                        <label>📅 Progetta una TIMELINE dell'intervento (3 mesi)</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Organizza le azioni nel tempo: cosa fai nel primo mese? Nel secondo? Nel terzo? In che ordine attivi le risorse?</p>
                        <textarea 
                            id="sfida-timeline" 
                            data-points="10"
                            placeholder="MESE 1 - URGENZE E PRESA IN CARICO:
• Settimana 1: ...
• Settimana 2: ...

MESE 2 - CONSOLIDAMENTO:
• ...

MESE 3 - AUTONOMIA E VERIFICA:
• ..." name="sfida-timeline"></textarea>
                    </div>
                </div>

                <div class="button-container">
                    <button class="button button-secondary" onclick="goToPhase(3)">
                        ← Torna alla Fase 2.5
                    </button>
                    <button class="button" onclick="completePhase(4, 5)">
                        ✅ Completato! → Vai alla Fase 4
                    </button>
                </div>
            </div>

            <!-- FASE 4: RIFLESSIONE -->
            <div class="fase" id="fase5">
                <h2><span class="emoji">💡</span> FASE 4: RIFLESSIONE - Metacognizione dell'apprendimento</h2>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⏱️</span> Cosa fai ora (15 minuti)</h3>
                    <ul>
                        <li>Rifletti sul tuo percorso di apprendimento</li>
                        <li>Confronta le tue idee iniziali con le competenze acquisite</li>
                        <li>Identifica punti di forza e aree di miglioramento</li>
                        <li>Rispondi alle domande metacognitive</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">💡</span> Perché lo fai</h3>
                    <p><strong>La riflessione metacognitiva</strong> consolida l'apprendimento e ti rende consapevole di come impari! Pensare sul proprio pensiero migliora la capacità di apprendere in futuro.</p>
                </div>

                <h3 style="color: var(--color-turchese); margin: 30px 0 20px;">🧠 DOMANDE RIFLESSIVE (30 punti totali)</h3>

                <div class="card">
                    <h4>1️⃣ Evoluzione della comprensione (5 punti)</h4>
                    <div class="input-area">
                        <label>Confronta il tuo brainstorming iniziale con ciò che sai ora: cosa è cambiato nella tua comprensione del TSSAS?</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Rileggi quello che avevi scritto nella Fase 1 e rifletti sulle differenze</p>
                        <textarea 
                            id="riflessione-1" 
                            data-points="5"
                            placeholder="All'inizio pensavo che il TSSAS fosse... ora ho capito che...
I concetti che non conoscevo erano... la cosa che mi ha sorpreso di più è stata..." name="riflessione-1"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h4>2️⃣ I tre concetti chiave (5 punti)</h4>
                    <div class="input-area">
                        <label>Quali sono i 3 concetti più importanti che hai scoperto in questo percorso? Perché li ritieni fondamentali?</label>
                        <textarea 
                            id="riflessione-2" 
                            data-points="5"
                            placeholder="1. Il modello bio-psico-sociale perché...
2. Il lavoro di rete perché...
3. ..." name="riflessione-2"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h4>3️⃣ Difficoltà incontrate (5 punti)</h4>
                    <div class="input-area">
                        <label>Quali argomenti o attività hai trovato più difficili? Cosa ti è rimasto meno chiaro?</label>
                        <textarea 
                            id="riflessione-3" 
                            data-points="5"
                            placeholder="L'argomento più complesso è stato... perché...
L'esercizio più difficile è stato... vorrei approfondire..." name="riflessione-3"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h4>4️⃣ Applicazione pratica (5 punti)</h4>
                    <div class="input-area">
                        <label>Nell'analisi del caso di Maria (Fase 3), quali difficoltà hai incontrato? Cosa ti è sembrato più facile?</label>
                        <textarea 
                            id="riflessione-4" 
                            data-points="5"
                            placeholder="Applicare il modello bio-psico-sociale al caso è stato... perché...
La parte più facile è stata... la più complessa...
Mi sono sentito/a preparato/a per..." name="riflessione-4"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h4>5️⃣ Autovalutazione competenze deontologiche (5 punti)</h4>
                    <div class="input-area">
                        <label>Tra le competenze del TSSAS (ascolto, empatia, creatività, flessibilità), quali ritieni di possedere già? Quali dovresti sviluppare?</label>
                        <textarea 
                            id="riflessione-5" 
                            data-points="5"
                            placeholder="Competenze che penso di avere già: ... perché...
Competenze da sviluppare: ... come posso allenarle?
Situazioni in cui queste competenze sono fondamentali: ..." name="riflessione-5"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h4>6️⃣ Il mio processo di apprendimento (5 punti)</h4>
                    <div class="input-area">
                        <label>Quale fase (1-2-2.5-3) ti è stata più utile per imparare? Come apprendi meglio?</label>
                        <textarea 
                            id="riflessione-6" 
                            data-points="5"
                            placeholder="La fase più utile è stata la... perché...
Imparo meglio quando: leggo teoria / analizzo casi pratici / faccio esercizi / rifletto...
In futuro potrei migliorare il mio apprendimento..." name="riflessione-6"></textarea>
                    </div>
                </div>

                <div class="button-container">
                    <button class="button button-secondary" onclick="goToPhase(4)">
                        ← Torna alla Fase 3
                    </button>
                    <button class="button" onclick="completePhase(5, 6)">
                        ✅ Completato! → Vai alla Fase 5 (COMPITO FINALE)
                    </button>
                </div>
            </div>

            <!-- FASE 5: APPLICAZIONE PROFESSIONALE -->
            <div class="fase" id="fase6">
                <h2><span class="emoji">🏥</span> FASE 5: APPLICAZIONE - Progetto professionale completo</h2>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⏱️</span> Cosa fai ora (30-40 minuti)</h3>
                    <ul>
                        <li>Analizza un caso professionale complesso e realistico</li>
                        <li>Progetta un intervento articolato come TSSAS</li>
                        <li>Considera aspetti normativi, etici, relazionali</li>
                        <li>Dimostra la tua competenza professionale</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">💡</span> Perché lo fai</h3>
                    <p><strong>Questo è il momento della verità!</strong> Applicando tutte le conoscenze acquisite a un caso complesso, dimostri di aver sviluppato una vera competenza professionale. Questo è ciò che farai nella realtà lavorativa!</p>
                </div>

                <h3 style="color: var(--color-fucsia); margin: 30px 0 20px;">📋 CASO PROFESSIONALE COMPLESSO</h3>

                <div class="card" style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-left-color: #FF9800;">
                    <h4 style="color: #E65100;">🏢 CONTESTO</h4>
                    <p>Sei TSSAS presso il <strong>Centro Diurno "Casa Serena"</strong> che accoglie 25 anziani (età media 78 anni) per attività di socializzazione, animazione e assistenza leggera. Il centro opera 5 giorni a settimana, dalle 9 alle 17.</p>
                    <p style="margin-top: 15px;"><strong>L'équipe è composta da:</strong> 1 coordinatrice (assistente sociale), 2 TSSAS (tu e una collega), 2 OSS, 1 animatore, 1 fisioterapista part-time.</p>
                </div>

                <div class="card" style="background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%); border-left-color: #F44336;">
                    <h4 style="color: #C62828;">⚠️ LA SITUAZIONE PROBLEMATICA</h4>
                    <p><strong>Sono emerse alcune criticità nell'ultimo mese:</strong></p>
                    <ul style="margin-top: 15px;">
                        <li><strong>Signor Giuseppe (82 anni):</strong> vedovo da 2 anni, viene al centro da 18 mesi. Ultimamente è sempre più isolato, rifiuta le attività di gruppo, passa il tempo seduto da solo. A casa vive con il figlio (55 anni), che lavora tutto il giorno. Il figlio ha riferito preoccupato che il padre "non è più lui" e ha smesso di prendersi cura di sé.</li>
                        
                        <li style="margin-top: 15px;"><strong>Signora Anna (75 anni):</strong> vive sola, frequenta il centro da 6 mesi. È molto loquace ma tende a monopolizzare le conversazioni. Alcuni anziani hanno espresso fastidio. Durante un'attività ha litigato con un altro ospite accusandolo di "rubarle la merenda". Il medico ha segnalato un peggioramento della sua pressione arteriosa.</li>
                        
                        <li style="margin-top: 15px;"><strong>Tensioni nel gruppo:</strong> Si sono formati "gruppetti" che escludono alcuni ospiti. C'è meno partecipazione alle attività. L'animatore è demotivato e ha chiesto un confronto.</li>
                        
                        <li style="margin-top: 15px;"><strong>Richiesta delle famiglie:</strong> Alcuni familiari chiedono più comunicazione sullo stato dei loro cari e vorrebbero essere più coinvolti nelle attività del centro.</li>
                        
                        <li style="margin-top: 15px;"><strong>Vincoli organizzativi:</strong> Budget ridotto, non è possibile assumere nuovo personale. Il fisioterapista andrà in ferie per 3 settimane il mese prossimo.</li>
                    </ul>
                </div>

                <div class="card" style="background: linear-gradient(135deg, #E1F5FE 0%, #B3E5FC 100%); border-left-color: #03A9F4;">
                    <h4 style="color: #0277BD;">🎯 IL TUO COMPITO</h4>
                    <p>La coordinatrice ti ha incaricato di <strong>analizzare la situazione e proporre un progetto di intervento</strong> che affronti le criticità emerse, coinvolgendo l'intera équipe e le famiglie.</p>
                    <p style="margin-top: 10px;">Dovrai presentare il progetto in una riunione d'équipe tra 1 settimana.</p>
                </div>

                <h3 style="color: var(--color-fucsia); margin: 40px 0 20px;">📝 PROGETTA IL TUO INTERVENTO (50 punti totali)</h3>

                <!-- Task 1 -->
                <div class="card">
                    <h4>TASK 1: ANALISI DELLA SITUAZIONE (15 punti)</h4>
                    <div class="input-area">
                        <label>A) Applica il modello bio-psico-sociale a Giuseppe e Anna</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Analizza i due casi individuali considerando le tre dimensioni</p>
                        <textarea 
                            id="task1-analisi-casi" 
                            data-points="8"
                            style="min-height: 180px;"
                            placeholder="GIUSEPPE:
- Dimensione biologica: ...
- Dimensione psicologica: ...
- Dimensione sociale: ...

ANNA:
- Dimensione biologica: ...
- Dimensione psicologica: ...
- Dimensione sociale: ..." name="task1-analisi-casi"></textarea>
                    </div>

                    <div class="input-area">
                        <label>B) Identifica le cause delle tensioni di gruppo e del calo di partecipazione</label>
                        <textarea 
                            id="task1-analisi-gruppo" 
                            data-points="7"
                            placeholder="Le tensioni nel gruppo sono causate da...
Il calo di partecipazione può dipendere da...
Le dinamiche relazionali mostrano...
Il ruolo dell'animatore in questa situazione..." name="task1-analisi-gruppo"></textarea>
                    </div>
                </div>

                <!-- Task 2 -->
                <div class="card">
                    <h4>TASK 2: PROGETTAZIONE INTERVENTO (20 punti)</h4>
                    
                    <div class="input-area">
                        <label>A) Obiettivi del progetto (almeno 3 obiettivi S.M.A.R.T.)</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Specifici, Misurabili, Raggiungibili, Rilevanti, Temporizzati</p>
                        <textarea 
                            id="task2-obiettivi" 
                            data-points="6"
                            placeholder="Obiettivo 1 (per Giuseppe): ...
Obiettivo 2 (per le dinamiche di gruppo): ...
Obiettivo 3 (per il coinvolgimento famiglie): ..." name="task2-obiettivi"></textarea>
                    </div>

                    <div class="input-area">
                        <label>B) Azioni concrete per Giuseppe (intervento individualizzato)</label>
                        <textarea 
                            id="task2-giuseppe" 
                            data-points="5"
                            placeholder="• Colloquio individuale per...
• Coinvolgimento del figlio...
• Attività specifiche per...
• Monitoraggio...
• Eventuale coinvolgimento di altri professionisti (quali? perché?)..." name="task2-giuseppe"></textarea>
                    </div>

                    <div class="input-area">
                        <label>C) Azioni concrete per Anna e per migliorare il clima di gruppo</label>
                        <textarea 
                            id="task2-gruppo" 
                            data-points="5"
                            placeholder="Per Anna:
• ...

Per il gruppo:
• Attività di team building...
• Gestione dei conflitti...
• Riorganizzazione spazi/tempi..." name="task2-gruppo"></textarea>
                    </div>

                    <div class="input-area">
                        <label>D) Strategie di coinvolgimento delle famiglie</label>
                        <textarea 
                            id="task2-famiglie" 
                            data-points="4"
                            placeholder="• Modalità di comunicazione periodica...
• Incontri/eventi...
• Co-progettazione attività..." name="task2-famiglie"></textarea>
                    </div>
                </div>

                <!-- Task 3 -->
                <div class="card">
                    <h4>TASK 3: ASPETTI TRASVERSALI (15 punti)</h4>
                    
                    <div class="input-area">
                        <label>A) Lavoro di équipe e gestione risorse</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Come coinvolgi l'équipe? Come gestisci i vincoli (budget, assenza fisioterapista)?</p>
                        <textarea 
                            id="task3-equipe" 
                            data-points="5"
                            placeholder="Ruolo di ciascun membro dell'équipe nel progetto:
• Coordinatrice: ...
• Io (TSSAS): ...
• Collega TSSAS: ...
• OSS: ...
• Animatore: ...

Gestione vincoli:
• Budget limitato: soluzioni creative...
• Assenza fisioterapista: ..." name="task3-equipe"></textarea>
                    </div>

                    <div class="input-area">
                        <label>B) Dimensione etica e deontologica</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Privacy, autodeterminazione, dignità, rispetto... Come garantisci questi principi?</p>
                        <textarea 
                            id="task3-etica" 
                            data-points="5"
                            placeholder="Nel caso di Giuseppe, rispetto l'autodeterminazione...
Per Anna, garantisco la dignità...
Nella comunicazione con le famiglie, tutelo la privacy...
Il coinvolgimento degli ospiti nelle decisioni..." name="task3-etica"></textarea>
                    </div>

                    <div class="input-area">
                        <label>C) Valutazione dell'efficacia del progetto</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Come capirai se il progetto funziona? Quali indicatori userai?</p>
                        <textarea 
                            id="task3-valutazione" 
                            data-points="5"
                            placeholder="Indicatori per Giuseppe: ...
Indicatori per il clima di gruppo: ...
Strumenti di verifica (osservazione, questionari, colloqui...): ...
Tempi di monitoraggio: ..." name="task3-valutazione"></textarea>
                    </div>
                </div>

                <div class="info-box info-box-purple" style="margin-top: 30px;">
                    <h3><span class="emoji">💎</span> RIFLESSIONE FINALE</h3>
                    <p style="margin-bottom: 15px;">Dopo aver completato il progetto, rifletti:</p>
                    <div class="input-area">
                        <label>Come ti sei sentito/a nell'affrontare questa situazione complessa? Quali competenze hai messo in gioco? Cosa ti ha aiutato?</label>
                        <textarea 
                            id="riflessione-finale-caso"
                            placeholder="Mi sono sentito/a... Le competenze che ho utilizzato... Ciò che mi ha aiutato è stato... Se fossi davvero TSSAS in questa situazione, la difficoltà maggiore sarebbe..." name="riflessione-finale-caso"></textarea>
                    </div>
                </div>

                <div class="button-container">
                    <button class="button button-secondary" onclick="goToPhase(5)">
                        ← Torna alla Fase 4
                    </button>
                    <button class="button" onclick="completePhase(6, 7)">
                        ✅ Completato! → Vai alla Fase 6 FINALE
                    </button>
                </div>
            </div>

            <!-- FASE 6: VALUTAZIONE E PIANO D'AZIONE -->
            <div class="fase" id="fase7">
                <h2><span class="emoji">🏆</span> FASE 6: VALUTAZIONE - Celebra il tuo apprendimento!</h2>

                <div class="info-box info-box-yellow">
                    <h3><span class="emoji">⏱️</span> Cosa fai ora (20 minuti)</h3>
                    <ul>
                        <li>Autovaluta le competenze acquisite</li>
                        <li>Completa il quiz finale ricapitolativo</li>
                        <li>Crea il tuo piano d'azione personalizzato</li>
                        <li>Ricevi il badge finale e celebra il successo!</li>
                    </ul>
                </div>

                <div class="info-box info-box-green">
                    <h3><span class="emoji">💡</span> Perché lo fai</h3>
                    <p><strong>Celebrare i traguardi</strong> e pianificare il futuro consolida l'apprendimento e ti motiva a continuare! Sei arrivato/a alla fine del percorso: è tempo di raccogliere i frutti del tuo impegno.</p>
                </div>

                <h3 style="color: var(--color-turchese); margin: 30px 0 20px;">📊 AUTOVALUTAZIONE COMPETENZE (20 punti)</h3>

                <p style="margin-bottom: 25px; color: #666;">Valuta onestamente il tuo livello di competenza su scala 1-5 per ciascun aspetto:</p>

                <div class="autovalutazione-grid">
                    <div class="competenza-item">
                        <label>1. Comprendo il modello bio-psico-sociale e so applicarlo</label>
                        <div class="scala-valutazione">
                            <input type="radio" name="comp1" id="comp1_1" value="1">
                            <label for="comp1_1">1<br>Per niente</label>
                            <input type="radio" name="comp1" id="comp1_2" value="2">
                            <label for="comp1_2">2<br>Poco</label>
                            <input type="radio" name="comp1" id="comp1_3" value="3">
                            <label for="comp1_3">3<br>Abbastanza</label>
                            <input type="radio" name="comp1" id="comp1_4" value="4">
                            <label for="comp1_4">4<br>Molto</label>
                            <input type="radio" name="comp1" id="comp1_5" value="5">
                            <label for="comp1_5">5<br>Pienamente</label>
                        </div>
                    </div>

                    <div class="competenza-item">
                        <label>2. Conosco le competenze e i contesti operativi del TSSAS</label>
                        <div class="scala-valutazione">
                            <input type="radio" name="comp2" id="comp2_1" value="1">
                            <label for="comp2_1">1</label>
                            <input type="radio" name="comp2" id="comp2_2" value="2">
                            <label for="comp2_2">2</label>
                            <input type="radio" name="comp2" id="comp2_3" value="3">
                            <label for="comp2_3">3</label>
                            <input type="radio" name="comp2" id="comp2_4" value="4">
                            <label for="comp2_4">4</label>
                            <input type="radio" name="comp2" id="comp2_5" value="5">
                            <label for="comp2_5">5</label>
                        </div>
                    </div>

                    <div class="competenza-item">
                        <label>3. So analizzare le tipologie di utenza e i loro bisogni specifici</label>
                        <div class="scala-valutazione">
                            <input type="radio" name="comp3" id="comp3_1" value="1">
                            <label for="comp3_1">1</label>
                            <input type="radio" name="comp3" id="comp3_2" value="2">
                            <label for="comp3_2">2</label>
                            <input type="radio" name="comp3" id="comp3_3" value="3">
                            <label for="comp3_3">3</label>
                            <input type="radio" name="comp3" id="comp3_4" value="4">
                            <label for="comp3_4">4</label>
                            <input type="radio" name="comp3" id="comp3_5" value="5">
                            <label for="comp3_5">5</label>
                        </div>
                    </div>

                    <div class="competenza-item">
                        <label>4. Comprendo l'importanza del lavoro di rete formale e informale</label>
                        <div class="scala-valutazione">
                            <input type="radio" name="comp4" id="comp4_1" value="1">
                            <label for="comp4_1">1</label>
                            <input type="radio" name="comp4" id="comp4_2" value="2">
                            <label for="comp4_2">2</label>
                            <input type="radio" name="comp4" id="comp4_3" value="3">
                            <label for="comp4_3">3</label>
                            <input type="radio" name="comp4" id="comp4_4" value="4">
                            <label for="comp4_4">4</label>
                            <input type="radio" name="comp4" id="comp4_5" value="5">
                            <label for="comp4_5">5</label>
                        </div>
                    </div>

                    <div class="competenza-item">
                        <label>5. So progettare interventi strutturati applicando la teoria</label>
                        <div class="scala-valutazione">
                            <input type="radio" name="comp5" id="comp5_1" value="1">
                            <label for="comp5_1">1</label>
                            <input type="radio" name="comp5" id="comp5_2" value="2">
                            <label for="comp5_2">2</label>
                            <input type="radio" name="comp5" id="comp5_3" value="3">
                            <label for="comp5_3">3</label>
                            <input type="radio" name="comp5" id="comp5_4" value="4">
                            <label for="comp5_4">4</label>
                            <input type="radio" name="comp5" id="comp5_5" value="5">
                            <label for="comp5_5">5</label>
                        </div>
                    </div>

                    <div class="competenza-item">
                        <label>6. Ho consapevolezza della dimensione etica e deontologica del TSSAS</label>
                        <div class="scala-valutazione">
                            <input type="radio" name="comp6" id="comp6_1" value="1">
                            <label for="comp6_1">1</label>
                            <input type="radio" name="comp6" id="comp6_2" value="2">
                            <label for="comp6_2">2</label>
                            <input type="radio" name="comp6" id="comp6_3" value="3">
                            <label for="comp6_3">3</label>
                            <input type="radio" name="comp6" id="comp6_4" value="4">
                            <label for="comp6_4">4</label>
                            <input type="radio" name="comp6" id="comp6_5" value="5">
                            <label for="comp6_5">5</label>
                        </div>
                    </div>
                </div>

                <h3 style="color: var(--color-fucsia); margin: 40px 0 20px;">📝 QUIZ FINALE RICAPITOLATIVO (30 punti)</h3>

                <div class="quiz-container">
                    <p style="margin-bottom: 25px; color: #666;">10 domande per verificare il consolidamento delle conoscenze. Ogni risposta corretta vale 3 punti!</p>

                    <!-- Domanda 1 -->
                    <div class="quiz-question">
                        <h4>1. Il TSSAS è principalmente un professionista:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf1')">
                                <input type="radio" name="qf1" id="qf1_a">
                                <label for="qf1_a">Dell'area sanitaria che si occupa di cure mediche</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf1')">
                                <input type="radio" name="qf1" id="qf1_b">
                                <label for="qf1_b">Della relazione d'aiuto che promuove benessere bio-psico-sociale</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf1')">
                                <input type="radio" name="qf1" id="qf1_c">
                                <label for="qf1_c">Dell'area amministrativa dei servizi sociali</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf1"></div>
                    </div>

                    <!-- Domanda 2 -->
                    <div class="quiz-question">
                        <h4>2. Nel caso di un anziano con diabete (biologico) che vive solo e si sente triste (psicologico) con pochi contatti sociali (sociale), il TSSAS deve:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf2')">
                                <input type="radio" name="qf2" id="qf2_a">
                                <label for="qf2_a">Concentrarsi solo sulla gestione del diabete</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf2')">
                                <input type="radio" name="qf2" id="qf2_b">
                                <label for="qf2_b">Intervenire su tutte e tre le dimensioni in modo integrato</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf2')">
                                <input type="radio" name="qf2" id="qf2_c">
                                <label for="qf2_c">Occuparsi solo della socializzazione</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf2"></div>
                    </div>

                    <!-- Domanda 3 -->
                    <div class="quiz-question">
                        <h4>3. La famiglia come utenza dei servizi socio-sanitari oggi:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf3')">
                                <input type="radio" name="qf3" id="qf3_a">
                                <label for="qf3_a">Ã sempre composta da due genitori sposati e figli</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf3')">
                                <input type="radio" name="qf3" id="qf3_b">
                                <label for="qf3_b">Ha forme diverse: nucleare, single, ricostituita, convivenze</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf3')">
                                <input type="radio" name="qf3" id="qf3_c">
                                <label for="qf3_c">Non è più un'utenza rilevante dei servizi</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf3"></div>
                    </div>

                    <!-- Domanda 4 -->
                    <div class="quiz-question">
                        <h4>4. La crisi adolescenziale si caratterizza principalmente per:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf4')">
                                <input type="radio" name="qf4" id="qf4_a">
                                <label for="qf4_a">Problemi esclusivamente fisici legati alla crescita</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf4')">
                                <input type="radio" name="qf4" id="qf4_b">
                                <label for="qf4_b">Difficoltà nel passaggio dall'identità infantile a quella adulta</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf4')">
                                <input type="radio" name="qf4" id="qf4_c">
                                <label for="qf4_c">Semplice ribellione che passa da sola senza interventi</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf4"></div>
                    </div>

                    <!-- Domanda 5 -->
                    <div class="quiz-question">
                        <h4>5. Secondo l'ICF (OMS), la disabilità:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf5')">
                                <input type="radio" name="qf5" id="qf5_a">
                                <label for="qf5_a">Ã solo una condizione biologica individuale</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf5')">
                                <input type="radio" name="qf5" id="qf5_b">
                                <label for="qf5_b">Ã una relazione tra salute e fattori personali/ambientali</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf5')">
                                <input type="radio" name="qf5" id="qf5_c">
                                <label for="qf5_c">Riguarda solo le persone con handicap fisici gravi</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf5"></div>
                    </div>

                    <!-- Domanda 6 -->
                    <div class="quiz-question">
                        <h4>6. Le "nuove dipendenze" includono:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf6')">
                                <input type="radio" name="qf6" id="qf6_a">
                                <label for="qf6_a">Solo alcol e droghe</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf6')">
                                <input type="radio" name="qf6" id="qf6_b">
                                <label for="qf6_b">Nomofobia, hikikomori, cyber-relation, eccessoressia</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf6')">
                                <input type="radio" name="qf6" id="qf6_c">
                                <label for="qf6_c">Solo problemi che riguardano gli adulti</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf6"></div>
                    </div>

                    <!-- Domanda 7 -->
                    <div class="quiz-question">
                        <h4>7. Nel lavoro di rete, le cooperative sociali sono:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf7')">
                                <input type="radio" name="qf7" id="qf7_a">
                                <label for="qf7_a">Reti informali come la famiglia</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf7')">
                                <input type="radio" name="qf7" id="qf7_b">
                                <label for="qf7_b">Reti formali secondarie strutturate</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf7')">
                                <input type="radio" name="qf7" id="qf7_c">
                                <label for="qf7_c">Non fanno parte del lavoro di rete del TSSAS</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf7"></div>
                    </div>

                    <!-- Domanda 8 -->
                    <div class="quiz-question">
                        <h4>8. La "relazione d'aiuto" del TSSAS si basa su:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf8')">
                                <input type="radio" name="qf8" id="qf8_a">
                                <label for="qf8_a">Fornire soluzioni pronte senza coinvolgere l'utente</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf8')">
                                <input type="radio" name="qf8" id="qf8_b">
                                <label for="qf8_b">Far emergere potenziali e life skills per favorire l'autogestione</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf8')">
                                <input type="radio" name="qf8" id="qf8_c">
                                <label for="qf8_c">Sostituirsi completamente all'utente nelle decisioni</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf8"></div>
                    </div>

                    <!-- Domanda 9 -->
                    <div class="quiz-question">
                        <h4>9. Nella terza età, il TSSAS deve considerare che:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf9')">
                                <input type="radio" name="qf9" id="qf9_a">
                                <label for="qf9_a">L'anziano è solo un peso per la società</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf9')">
                                <input type="radio" name="qf9" id="qf9_b">
                                <label for="qf9_b">L'anziano è risorsa da valorizzare e la dimensione spirituale va mantenuta attiva</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf9')">
                                <input type="radio" name="qf9" id="qf9_c">
                                <label for="qf9_c">Dopo i 65 anni non c'è più possibilità di crescita personale</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf9"></div>
                    </div>

                    <!-- Domanda 10 -->
                    <div class="quiz-question">
                        <h4>10. Un intervento del TSSAS è efficace quando:</h4>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf10')">
                                <input type="radio" name="qf10" id="qf10_a">
                                <label for="qf10_a">Si applica lo stesso protocollo a tutti gli utenti</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true, 'qf10')">
                                <input type="radio" name="qf10" id="qf10_b">
                                <label for="qf10_b">Ã individualizzato, integra le tre dimensioni bio-psico-sociali e coinvolge la rete</label>
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false, 'qf10')">
                                <input type="radio" name="qf10" id="qf10_c">
                                <label for="qf10_c">Il TSSAS lavora da solo senza collaborare con altri</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback_qf10"></div>
                    </div>
                </div>

                <h3 style="color: var(--color-turchese); margin: 40px 0 20px;">🎯 IL MIO PIANO D'AZIONE PERSONALE</h3>

                <div class="card">
                    <p style="margin-bottom: 20px;">Ora che hai completato il percorso, definisci i tuoi prossimi passi per continuare a crescere come futuro TSSAS:</p>
                    
                    <div class="input-area">
                        <label>📚 COSA voglio approfondire nei prossimi mesi?</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Argomenti, competenze, tematiche che vuoi studiare meglio</p>
                        <textarea 
                            id="piano-cosa"
                            placeholder="Esempio: Vorrei approfondire le tecniche di comunicazione con persone con disabilità, studiare meglio la normativa sui servizi sociali, capire di più sulle dipendenze tecnologiche..." name="piano-cosa"></textarea>
                    </div>

                    <div class="input-area">
                        <label>🛠️ COME intendo farlo?</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Azioni concrete, risorse, strumenti</p>
                        <textarea 
                            id="piano-come"
                            placeholder="Esempio: Leggere libri consigliati, seguire canali YouTube sul tema, partecipare a laboratori a scuola, fare volontariato in una cooperativa sociale, parlare con professionisti del settore..." name="piano-come"></textarea>
                    </div>

                    <div class="input-area">
                        <label>📅 QUANDO lo farò? (tempistica realistica)</label>
                        <textarea 
                            id="piano-quando"
                            placeholder="Esempio: Entro la fine di questo mese..., nei prossimi 3 mesi..., quest'anno scolastico..., durante le vacanze estive..." name="piano-quando"></textarea>
                    </div>

                    <div class="input-area">
                        <label>💪 Il mio IMPEGNO personale come futuro TSSAS</label>
                        <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">Una frase che rappresenta la tua motivazione e i tuoi valori professionali</p>
                        <textarea 
                            id="piano-impegno"
                            placeholder="Esempio: Mi impegno a essere un TSSAS che... Voglio lavorare per... Il mio obiettivo professionale è..." name="piano-impegno"></textarea>
                    </div>
                </div>

                <div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--color-lime) 0%, var(--color-lime-dark) 100%); border-radius: 20px; margin: 40px 0;">
                    <div style="font-size: 4em; margin-bottom: 20px;">🎉</div>
                    <h2 style="color: #333; font-size: 2.5em; margin-bottom: 15px;">COMPLIMENTI!</h2>
                    <p style="font-size: 1.3em; color: #333; margin-bottom: 25px;">Hai completato il percorso interattivo sul TSSAS!</p>
                    <div style="background: white; display: inline-block; padding: 20px 40px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <p style="color: #666; margin-bottom: 10px;">Punteggio finale:</p>
                        <p style="font-size: 3em; font-weight: bold; color: var(--color-fucsia);"><span id="finalScore">0</span>/290</p>
                    </div>
                </div>

                <div class="button-container">
                    <button class="button button-secondary" onclick="goToPhase(6)">
                        ← Torna alla Fase 5
                    </button>
                    <button class="button button-success" onclick="printWork()">
                        🖨️ Stampa il tuo lavoro completo
                    </button>
                    <button class="button" onclick="exportTXT()">
                        💾 Esporta TXT
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const PAGE_ID = document.querySelector('meta[name="page-id"]')?.content || window.location.pathname;
        const PHASE_MAP = { 1: 'fase1', 2: 'fase2', 3: 'fase3', 4: 'fase4', 5: 'fase5', 6: 'fase6', 7: 'fase7' };
        const stateInputs = {
            totalScore: document.getElementById('stateTotalScore'),
            currentPhase: document.getElementById('stateCurrentPhase'),
            completed: document.getElementById('stateCompletedTextareas'),
            badges: document.getElementById('stateUnlockedBadges'),
            quizScores: document.getElementById('stateQuizScores')
        };

        // =======================
        // SISTEMA PUNTEGGI E GAMIFICATION
        // =======================
        let totalScore = 0;
        let currentPhaseNum = 1;
        let quizScores = {};
        let completedTextareas = new Set();
        let unlockedBadges = new Set();

        // Badge definitions
        const badges = {
            1: { id: 'badge1', phase: 1, points: 20 },
            2: { id: 'badge2', phase: 2, points: 45 },
            3: { id: 'badge3', phase: 3, points: 60 },
            4: { id: 'badge4', phase: 4, points: 95 },
            5: { id: 'badge5', phase: 5, points: 125 },
            6: { id: 'badge6', phase: 6, points: 200 }
        };

        // Phase descriptions
        const phaseDescriptions = {
            1: 'Fase 1: Attivazione - Scopri il TSSAS',
            2: 'Fase 2: Esplorazione - Costruisci le basi',
            3: 'Fase 2.5: Approfondimento - Le tipologie di utenza',
            4: 'Fase 3: Sperimentazione - Applica le conoscenze',
            5: 'Fase 4: Riflessione - Metacognizione',
            6: 'Fase 5: Applicazione - Progetto professionale',
            7: 'Fase 6: Valutazione - Celebra il successo!'
        };

        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            attachTextareaListeners();
            updateScoreDisplay();
            restoreUIFromState({ activatePhase: true, scroll: false });
            syncStateToInputs();
        });

        window.addEventListener('mo:progress-restored', (event) => {
            const detail = event?.detail || {};
            if (detail.pageId && detail.pageId !== PAGE_ID) return;
            if (detail.data) {
                applyStateFromData(detail.data, { activatePhase: true, scroll: false });
            } else {
                resetState();
            }
        });

        function parseJSONSafely(value, fallback) {
            if (typeof value !== 'string' || !value) return fallback;
            try {
                return JSON.parse(value);
            } catch (error) {
                console.warn('Impossibile analizzare JSON:', error);
                return fallback;
            }
        }

        function clampPhase(value) {
            const num = parseInt(value, 10);
            if (Number.isNaN(num)) return 1;
            return Math.min(Math.max(num, 1), 7);
        }

        function syncStateToInputs() {
            if (stateInputs.totalScore) stateInputs.totalScore.value = String(totalScore);
            if (stateInputs.currentPhase) stateInputs.currentPhase.value = String(currentPhaseNum);
            if (stateInputs.completed) stateInputs.completed.value = JSON.stringify(Array.from(completedTextareas));
            if (stateInputs.badges) stateInputs.badges.value = JSON.stringify(Array.from(unlockedBadges));
            if (stateInputs.quizScores) stateInputs.quizScores.value = JSON.stringify(quizScores);
        }

        function applyStateFromData(rawData = {}, options = {}) {
            const scoreValue = rawData.totalScore ?? rawData.stateTotalScore;
            if (scoreValue !== undefined) {
                const parsedScore = parseInt(scoreValue, 10);
                totalScore = Number.isNaN(parsedScore) ? 0 : parsedScore;
            }

            const phaseValue = rawData.currentPhase ?? rawData.stateCurrentPhase;
            if (phaseValue !== undefined) {
                currentPhaseNum = clampPhase(phaseValue);
            }

            const completedValue = rawData.completedTextareas ?? rawData.stateCompletedTextareas;
            if (completedValue !== undefined) {
                if (Array.isArray(completedValue)) {
                    completedTextareas = new Set(completedValue);
                } else if (typeof completedValue === 'string') {
                    completedTextareas = new Set(parseJSONSafely(completedValue, []));
                } else {
                    completedTextareas = new Set();
                }
            }

            const badgesValue = rawData.unlockedBadges ?? rawData.stateUnlockedBadges;
            if (badgesValue !== undefined) {
                if (Array.isArray(badgesValue)) {
                    unlockedBadges = new Set(badgesValue);
                } else if (typeof badgesValue === 'string') {
                    unlockedBadges = new Set(parseJSONSafely(badgesValue, []));
                } else {
                    unlockedBadges = new Set();
                }
            }

            const quizValue = rawData.quizScores ?? rawData.stateQuizScores;
            if (quizValue !== undefined) {
                if (typeof quizValue === 'string') {
                    quizScores = parseJSONSafely(quizValue, {});
                } else if (quizValue && typeof quizValue === 'object') {
                    quizScores = { ...quizValue };
                } else {
                    quizScores = {};
                }
            }

            syncStateToInputs();
            restoreUIFromState(options);
        }

        function restoreUIFromState(options = {}) {
            const activatePhase = options.activatePhase !== false;
            const scroll = options.scroll !== false;

            document.querySelectorAll('textarea[data-points], input[data-points]').forEach(element => {
                if (element.id) {
                    element.classList.toggle('completed', completedTextareas.has(element.id));
                }
            });

            Object.values(badges).forEach(badge => {
                const badgeEl = document.getElementById(badge.id);
                if (badgeEl) {
                    badgeEl.classList.toggle('unlocked', unlockedBadges.has(badge.id));
                }
            });

            updateScoreDisplay();
            updateProgressBar(currentPhaseNum);

            if (activatePhase) {
                goToPhase(currentPhaseNum, { scroll });
            }
        }

        function resetState() {
            totalScore = 0;
            currentPhaseNum = 1;
            quizScores = {};
            completedTextareas = new Set();
            unlockedBadges = new Set();

            document.querySelectorAll('textarea').forEach(el => {
                el.value = '';
                el.classList.remove('completed');
            });
            document.querySelectorAll('input[type="text"]').forEach(el => {
                el.value = '';
            });
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            Object.values(badges).forEach(badge => {
                const badgeEl = document.getElementById(badge.id);
                if (badgeEl) {
                    badgeEl.classList.remove('unlocked');
                }
            });

            syncStateToInputs();
            restoreUIFromState({ activatePhase: true, scroll: false });
        }

        // =======================
        // NAVIGAZIONE
        // =======================
        function goToPhase(phaseNum, options = {}) {
            const opts = (options && typeof options === 'object') ? options : {};
            const targetPhase = clampPhase(phaseNum);
            const shouldScroll = opts.scroll !== false;

            document.querySelectorAll('.fase').forEach(fase => {
                fase.classList.remove('active');
            });

            const phaseId = PHASE_MAP[targetPhase];
            const target = document.getElementById(phaseId);
            if (target) {
                target.classList.add('active');
            }

            updateProgressBar(targetPhase);

            currentPhaseNum = targetPhase;
            const phaseDisplay = document.getElementById('currentPhase');
            if (phaseDisplay) {
                phaseDisplay.textContent = targetPhase > 6 ? 6 : targetPhase;
            }

            if (shouldScroll) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            syncStateToInputs();
        }

        function completePhase(fromPhase, toPhase) {
            awardPhasePoints(fromPhase);
            checkBadgeUnlock();
            saveProgress();
            goToPhase(toPhase);
        }

        function updateProgressBar(phaseNum) {
            const targetPhase = clampPhase(phaseNum);
            const steps = [1, 2, 3, 4, 5, 6];

            steps.forEach((step, index) => {
                const stepEl = document.getElementById('step' + (index + 1));
                if (!stepEl) return;
                stepEl.classList.remove('active', 'completed');

                if (step <= targetPhase - 1) {
                    stepEl.classList.add('completed');
                } else if (step === targetPhase) {
                    stepEl.classList.add('active');
                }
            });

            const description = document.getElementById('progressText');
            if (description) {
                description.textContent = phaseDescriptions[targetPhase] || '';
            }
        }

        // =======================
        // SISTEMA PUNTI
        // =======================
        function attachTextareaListeners() {
            document.querySelectorAll('textarea[data-points], input[data-points]').forEach(element => {
                element.addEventListener('blur', function() {
                    if (this.value.trim().length > 20 && this.id && !completedTextareas.has(this.id)) {
                        completedTextareas.add(this.id);
                        this.classList.add('completed');
                        const points = parseInt(this.dataset.points, 10) || 0;
                        addPoints(points);
                        saveProgress();
                    }
                });
            });
        }

        function awardPhasePoints(phase) {
            const phaseElement = document.getElementById('fase' + phase);
            if (!phaseElement) return;

            const textareas = phaseElement.querySelectorAll('textarea[data-points], input[data-points]');
            textareas.forEach(textarea => {
                if (textarea.value.trim().length > 20 && textarea.id && !completedTextareas.has(textarea.id)) {
                    completedTextareas.add(textarea.id);
                    textarea.classList.add('completed');
                    const points = parseInt(textarea.dataset.points, 10) || 0;
                    addPoints(points);
                }
            });
        }

        function addPoints(points) {
            if (!points) return;
            totalScore += points;
            updateScoreDisplay();
            showPointsPopup(points);
            checkBadgeUnlock();
            syncStateToInputs();
        }

        function updateScoreDisplay() {
            const scoreEl = document.getElementById('currentScore');
            const finalScoreEl = document.getElementById('finalScore');
            const badgeCountEl = document.getElementById('badgeCount');

            if (scoreEl) scoreEl.textContent = totalScore;
            if (finalScoreEl) finalScoreEl.textContent = totalScore;
            if (badgeCountEl) badgeCountEl.textContent = unlockedBadges.size;
        }

        function showPointsPopup(points) {
            const popup = document.getElementById('pointsPopup');
            const overlay = document.getElementById('overlay');
            const valueEl = document.getElementById('pointsValue');

            if (!popup || !overlay || !valueEl) return;

            valueEl.textContent = '+' + points;
            overlay.classList.add('show');
            popup.classList.add('show');

            setTimeout(() => {
                popup.classList.remove('show');
                overlay.classList.remove('show');
            }, 1500);
        }

        // =======================
        // BADGE
        // =======================
        function checkBadgeUnlock() {
            Object.values(badges).forEach(badge => {
                if (totalScore >= badge.points && !unlockedBadges.has(badge.id)) {
                    unlockBadge(badge.id);
                }
            });
        }

        function unlockBadge(badgeId) {
            unlockedBadges.add(badgeId);
            const badgeEl = document.getElementById(badgeId);
            if (badgeEl) {
                badgeEl.classList.add('unlocked');
            }
            syncStateToInputs();
        }

        // =======================
        // QUIZ
        // =======================
        function checkAnswer(optionEl, isCorrect, questionName) {
            const options = optionEl.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });

            const radio = optionEl.querySelector('input[type="radio"]');
            if (radio) {
                radio.checked = true;
            }

            const feedback = document.getElementById('feedback_' + questionName);
            if (feedback) {
                feedback.classList.add('show');
            }

            if (isCorrect) {
                optionEl.classList.add('correct');
                if (feedback) {
                    feedback.classList.add('correct');
                    feedback.textContent = '✅ Corretto! Ben fatto!';
                }

                if (!quizScores[questionName]) {
                    const pointsPerQuestion = questionName.startsWith('qf') ? 3 : 5;
                    quizScores[questionName] = pointsPerQuestion;
                    addPoints(pointsPerQuestion);
                    saveProgress();
                }
            } else {
                optionEl.classList.add('incorrect');
                if (feedback) {
                    feedback.classList.add('incorrect');
                    feedback.textContent = '❌ Risposta errata. Riprova a riflettere!';
                }
            }
        }

        // =======================
        // SALVATAGGIO LOCALE
        // =======================
        function saveProgress() {
            syncStateToInputs();

            const data = {
                totalScore,
                currentPhase: currentPhaseNum,
                completedTextareas: Array.from(completedTextareas),
                unlockedBadges: Array.from(unlockedBadges),
                quizScores: { ...quizScores },
                stateTotalScore: stateInputs.totalScore?.value,
                stateCurrentPhase: stateInputs.currentPhase?.value,
                stateCompletedTextareas: stateInputs.completed?.value,
                stateUnlockedBadges: stateInputs.badges?.value,
                stateQuizScores: stateInputs.quizScores?.value
            };

            document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
                if (el.id) {
                    data[el.id] = el.value;
                }
            });

            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                if (radio.name) {
                    const key = radio.name + '_selected';
                    if (radio.checked) {
                        data[key] = radio.value;
                    } else if (!(key in data)) {
                        data[key] = null;
                    }
                }
            });

            try {
                localStorage.setItem('tssas_progress', JSON.stringify(data));
            } catch (error) {
                console.error('Errore nel salvataggio locale:', error);
            }
        }

        function loadProgress() {
            const saved = localStorage.getItem('tssas_progress');
            if (!saved) {
                goToPhase(currentPhaseNum, { scroll: false });
                return;
            }

            try {
                const data = JSON.parse(saved);
                applyStateFromData(data, { activatePhase: false });

                document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
                    if (el.id && data[el.id] !== undefined) {
                        el.value = data[el.id];
                    }
                });

                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    const key = radio.name + '_selected';
                    if (data[key] === radio.value) {
                        radio.checked = true;
                    }
                });

                restoreUIFromState({ activatePhase: true, scroll: false });
            } catch (error) {
                console.error('Errore nel caricamento del progresso locale:', error);
                resetState();
            }
        }

        setInterval(saveProgress, 30000);
        window.addEventListener('beforeunload', saveProgress);

        // =======================
        // ESPORTAZIONE
        // =======================
        function exportTXT() {
            let content = '='.repeat(60) + '
';
            content += 'IL TECNICO DEI SERVIZI SOCIO-SANITARI (TSSAS)
';
            content += 'Percorso Interattivo Gamificato - Il Mio Lavoro
';
            content += '='.repeat(60) + '

';
            content += 'Data: ' + new Date().toLocaleDateString('it-IT') + '
';
            content += 'Punteggio totale: ' + totalScore + '/290 punti
';
            content += 'Badge sbloccati: ' + unlockedBadges.size + '/6
';
            content += '
' + '='.repeat(60) + '

';

            document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
                if (el.value.trim()) {
                    const label = el.parentElement.querySelector('label');
                    if (label) {
                        content += label.textContent.trim() + '
';
                        content += '-'.repeat(40) + '
';
                        content += el.value.trim() + '

';
                    }
                }
            });

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'TSSAS_Percorso_' + new Date().toISOString().slice(0, 10) + '.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function printWork() {
            saveProgress();

            document.querySelectorAll('.fase').forEach(fase => {
                fase.style.display = 'block';
            });

            const nome = prompt('Inserisci il tuo nome e cognome:', '') || 'Studente';
            const classe = prompt('Inserisci la tua classe:', '') || '';
            const dataOggi = new Date().toLocaleDateString('it-IT');

            const copertina = `
                <div style="page-break-after: always; text-align: center; padding: 100px 20px;">
                    <h1 style="color: #1DD3D3; font-size: 2.5em; margin-bottom: 30px;">
                        Il Tecnico dei Servizi per la Sanità e l'Assistenza Sociale (TSSAS)
                    </h1>
                    <h2 style="color: #FF0090; margin: 30px 0;">
                        Percorso Interattivo Gamificato - Elaborato dello Studente
                    </h2>
                    <div style="margin-top: 80px; font-size: 1.3em; color: #333;">
                        <p><strong>Studente:</strong> ${nome}</p>
                        <p><strong>Classe:</strong> ${classe}</p>
                        <p><strong>Data:</strong> ${dataOggi}</p>
                    </div>
                    <div style="margin-top: 80px; color: #666;">
                        <p>IIS Meucci Mattei - Cagliari</p>
                        <p>Sede Decimomannu</p>
                        <p>Indirizzo: Servizi per la Sanità e l'Assistenza Sociale</p>
                    </div>
                </div>
            `;

            const container = document.querySelector('.container');
            container.insertAdjacentHTML('afterbegin', copertina);

            window.print();

            setTimeout(() => {
                const cover = container.firstElementChild;
                if (cover && cover.textContent.includes('Percorso Interattivo Gamificato')) {
                    cover.remove();
                }

                document.querySelectorAll('.fase').forEach(fase => {
                    fase.style.display = 'none';
                });
                const active = document.getElementById(PHASE_MAP[currentPhaseNum]);
                if (active) {
                    active.style.display = 'block';
                }
            }, 500);
        }
    </script>
    <script>
        window.MO_PROGRESS_CONFIG = {
            pagePath: window.location.pathname,
            inputSelector: 'textarea, input, select'
        };
    </script>
    <script type="module" src="../../assets/progress.js"></script>
    <script type="module" src="../../assets/progress-global.js"></script>
</body>
</html>
