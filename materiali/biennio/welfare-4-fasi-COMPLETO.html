<!DOCTYPE html>
<html lang="it">
<head>
    <meta name="page-id" content="attivita-materiali-biennio-welfare-4-fasi-completo-01">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Il Welfare: dalle Basi all'Azione - 4 Fasi di Apprendimento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            line-height: 1.8;
            font-size: 16px;
        }

        :focus-visible {
            outline: 3px solid #c41e3a;
            outline-offset: 2px;
        }

        /* HEADER FISSO */
        .header {
            background: linear-gradient(135deg, #000000 0%, #1a5c3a 50%, #c41e3a 100%);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            position: relative;
            top: auto;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }

        .header h1 {
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header.header-hidden {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }

        /* MODALITÀ STAMPA */
        body.print-mode {
            background: #ffffff !important;
            color: #000000 !important;
        }

        body.print-mode .header {
            position: static !important;
            transform: none !important;
            opacity: 1 !important;
            box-shadow: none !important;
            background: #ffffff !important;
            color: #000000 !important;
            border-bottom: 2px solid #1a5c3a;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
        }

        body.print-mode .header h1 {
            color: #000000 !important;
            text-shadow: none !important;
        }

        body.print-mode .phase-nav,
        body.print-mode .save-buttons,
        body.print-mode .save-status,
        body.print-mode .btn-next,
        body.print-mode .btn-download,
        body.print-mode .btn-primary,
        body.print-mode .btn-secondary,
        body.print-mode .slider-controls,
        body.print-mode .card-actions,
        body.print-mode .save-btn {
            display: none !important;
        }

        body.print-mode .container {
            padding: 1.5rem !important;
            margin-top: 0 !important;
        }

        body.print-mode .phase {
            display: block !important;
            page-break-after: always;
            break-after: page;
        }

        body.print-mode .phase:last-of-type {
            page-break-after: auto;
            break-after: auto;
        }

        body.print-mode .white-card {
            background: #ffffff !important;
            color: #000000 !important;
            box-shadow: none !important;
            border: 1px solid #dfe6e9;
        }

        body.print-mode .info-box {
            border-left-width: 3px;
        }

        body.print-mode .cards-grid {
            display: grid !important;
        }

        body.print-mode #cards-slider {
            display: none !important;
        }

        /* BARRA PROGRESSO FASI */
        .phase-nav {
            position: sticky;
            top: 0;
            z-index: 950;
            background: rgba(15, 15, 15, 0.92);
            backdrop-filter: blur(6px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 0.75rem 1.25rem;
        }

        .phase-nav-list {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .phase-dot {
            display: inline-flex;
            align-items: center;
            gap: 0.7rem;
            padding: 0.45rem 1.1rem;
            border-radius: 999px;
            border: 2px solid rgba(255,255,255,0.35);
            background: rgba(255,255,255,0.1);
            color: #ffffff;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.2s ease, border-color 0.2s ease;
            font-family: inherit;
            appearance: none;
            line-height: 1.2;
        }

        .phase-dot .phase-number {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.4);
            background: rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.05rem;
            font-weight: 700;
            color: #ffffff;
        }

        .phase-dot.completed {
            border-color: rgba(76, 175, 80, 0.8);
            background: rgba(76, 175, 80, 0.15);
        }

        .phase-dot.active {
            border-color: #c41e3a;
            background: linear-gradient(135deg, rgba(196,30,58,0.85) 0%, rgba(26,92,58,0.85) 100%);
            box-shadow: 0 0 18px rgba(196, 30, 58, 0.45);
            transform: translateY(-2px);
        }

        .phase-dot.active .phase-number {
            border-color: #ffffff;
            background: rgba(0,0,0,0.25);
        }

        .phase-dot.completed .phase-number {
            border-color: rgba(76, 175, 80, 0.9);
            background: rgba(76, 175, 80, 0.2);
        }

        .phase-label {
            display: inline-block;
            font-size: 0.8rem;
            line-height: 1;
        }
        }

        /* CONTAINER PRINCIPALE */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem 8rem;
        }

        /* FASE - CONTENITORE */
        .phase {
            display: none;
            animation: fadeIn 0.5s;
        }

        .phase.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CARD BIANCA */
        .white-card {
            background: white;
            color: #333;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* BOX COLORATI INFORMATIVI */
        .info-box {
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            border-left: 5px solid;
        }

        .info-box.yellow {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border-left-color: #ffc107;
            color: #5b4500;
        }

        .info-box.green {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left-color: #4caf50;
            color: #1b5e20;
        }

        .info-box.blue {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left-color: #2196f3;
            color: #0d47a1;
        }

        .info-box.red {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
            border-left-color: #e91e63;
            color: #880e4f;
        }

        .info-box h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-box ul {
            margin-left: 1.5rem;
        }

        .info-box li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        /* TITOLI GRANDI */
        .phase-title {
            color: #1a5c3a;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .section-title {
            color: #1a5c3a;
            font-size: 1.8rem;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #c41e3a;
        }

        /* ISTRUZIONI NUMERATE */
        .instructions {
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
        }

        .instructions h4 {
            color: #1a5c3a;
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .instructions ol {
            margin-left: 1.5rem;
            counter-reset: item;
            list-style-type: none;
        }

        .instructions ol li {
            margin-bottom: 1rem;
            line-height: 1.8;
            position: relative;
            padding-left: 2rem;
            font-size: 1.1rem;
        }

        .instructions ol li::before {
            content: counter(item) ".";
            counter-increment: item;
            position: absolute;
            left: 0;
            color: #c41e3a;
            font-weight: bold;
            font-size: 1.3rem;
        }

        /* CAMPI INPUT */
        .input-field {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
            margin: 0.5rem 0;
        }

        .input-field:focus {
            outline: none;
            border-color: #1a5c3a;
            box-shadow: 0 0 0 3px rgba(26, 92, 58, 0.1);
        }

        textarea.input-field {
            min-height: 120px;
            resize: vertical;
        }

        /* TABELLE */
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            background: white;
            padding: 1rem;
        }

        .table-wrapper::-webkit-scrollbar {
            height: 8px;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: rgba(26, 92, 58, 0.4);
            border-radius: 4px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            min-width: 620px;
        }

        .data-table th {
            background: #1a5c3a;
            color: white;
            padding: 1rem;
            text-align: left;
            font-size: 1rem;
        }

        .data-table td {
            padding: 1rem;
            border: 1px solid #ddd;
            vertical-align: top;
            word-break: break-word;
            hyphens: auto;
        }

        .data-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        /* PULSANTI */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #c41e3a;
            color: white;
        }

        .btn-primary:hover {
            background: #a01830;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(196, 30, 58, 0.4);
        }

        .btn-secondary {
            background: #1a5c3a;
            color: white;
        }

        .btn-secondary:hover {
            background: #145030;
            transform: translateY(-2px);
        }

        .btn-next {
            width: 100%;
            max-width: 400px;
            margin: 2rem auto;
            display: block;
            font-size: 1.2rem;
            padding: 1.2rem;
        }

        /* CARTE SERVIZIO */
        .cards-container {
            margin: 2rem 0;
        }

        .cards-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .cards-slider {
            display: none;
        }

        .cards-slider.active {
            display: block;
        }

        .card {
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            border-left: 5px solid #1a5c3a;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            border-left-color: #c41e3a;
        }

        .card-title {
            color: #1a5c3a;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.8rem;
        }

        .card-description {
            color: #555;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .card-pillar {
            display: inline-block;
            background: #1a5c3a;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 0.8rem;
        }

        .card-need {
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 6px;
            border-left: 3px solid #c41e3a;
            margin-top: 1rem;
        }

        /* SLIDER CARTE */
        .slider-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
        }

        .slider-btn {
            background: #1a5c3a;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .slider-btn:hover {
            background: #c41e3a;
        }

        .slider-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .slider-counter {
            font-weight: bold;
            font-size: 1.1rem;
            color: #1a5c3a;
        }

        /* PIRAMIDE MASLOW */
        .maslow-pyramid {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2rem 0;
            gap: 0.35rem;
        }

        .pyramid-level {
            --level-width: 95%;
            width: clamp(260px, var(--level-width), 95%);
            max-width: 900px;
            background: #f5f5f5;
            border: 2px solid #1a5c3a;
            padding: 1rem;
            border-radius: 8px;
            transition: all 0.3s;
            margin: 0 auto;
        }

        .pyramid-level + .pyramid-level {
            margin-top: 0.2rem;
        }

        .pyramid-level:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(26, 92, 58, 0.2);
        }

        .pyramid-level:nth-child(1) { --level-width: 95%; background: #ffebee; }
        .pyramid-level:nth-child(2) { --level-width: 85%; background: #fff3e0; }
        .pyramid-level:nth-child(3) { --level-width: 75%; background: #fff9c4; }
        .pyramid-level:nth-child(4) { --level-width: 65%; background: #e1f5fe; }
        .pyramid-level:nth-child(5) { --level-width: 55%; background: #e8f5e9; }
        .pyramid-level:nth-child(6) { --level-width: 45%; background: #f3e5f5; }
        .pyramid-level:nth-child(7) { --level-width: 35%; background: #fce4ec; }
        .pyramid-level:nth-child(8) { --level-width: 25%; background: #e8eaf6; }

        .pyramid-level h4 {
            color: #1a5c3a;
            margin-bottom: 0.5rem;
        }

        /* CARATTERISTICHE RELAZIONE D'AIUTO */
        .help-characteristics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .characteristic-card {
            background: white;
            border: 2px solid #1a5c3a;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .characteristic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(26, 92, 58, 0.2);
        }

        .characteristic-card h4 {
            color: #c41e3a;
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
        }

        /* SCENARI */
        .scenario-card {
            background: white;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .scenario-card h4 {
            font-size: 1.3rem;
            color: #1a5c3a;
            margin-bottom: 0.75rem;
        }

        /* COLLEGAMENTI */
        .connection-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        .connection-item.completed {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .connection-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .connection-box {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #ddd;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .connection-box.need { 
            background: #ffebee; 
            border-color: #ef5350;
        }

        .connection-box.service { 
            background: #e3f2fd; 
            border-color: #2196f3;
        }

        .connection-box.pillar { 
            background: #e8f5e9; 
            border-color: #4caf50;
        }

        .connection-arrow {
            font-size: 2rem;
            color: #1a5c3a;
            font-weight: bold;
        }

        .connection-select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
        }

        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #c8e6c9;
            color: #2e7d32;
            border: 2px solid #4caf50;
            display: block;
        }

        .feedback.incorrect {
            background: #ffcdd2;
            color: #c62828;
            border: 2px solid #f44336;
            display: block;
        }

        /* TABELLA LAVORO */
        .work-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .work-table th {
            background: #1a5c3a;
            color: white;
            padding: 1rem;
            text-align: left;
            font-size: 1rem;
        }

        .work-table td {
            padding: 1rem;
            border: 1px solid #ddd;
            vertical-align: top;
        }

        .work-table input,
        .work-table textarea,
        .work-table select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
        }

        .work-table textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* SALVATAGGIO */
        .save-buttons {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 999;
            flex-direction: column;
        }

        .save-btn {
            background: #c41e3a;
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s;
            white-space: nowrap;
        }

        .save-btn:hover {
            background: #1a5c3a;
            transform: translateY(-2px);
        }

        .save-status {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: #1a5c3a;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .save-status.show {
            opacity: 1;
        }

        /* RESPONSIVE ADJUSTMENTS */
        @media (max-width: 768px) {
            body {
                font-size: 15px;
            }

            .container {
                margin: 1.5rem auto;
                padding: 0 1rem 6rem;
            }

            .white-card {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }

            .table-wrapper {
                margin: 1.2rem 0;
            }

            .data-table {
                min-width: 520px;
            }

            .maslow-pyramid {
                gap: 0.25rem;
            }

            .pyramid-level {
                padding: 0.9rem;
            }

            .phase-title {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .info-box,
            .instructions {
                padding: 1.25rem;
            }

            .phase-nav {
                padding: 0.65rem 1rem;
            }

            .phase-nav-list {
                gap: 0.6rem;
            }

            .phase-dot {
                padding: 0.4rem 1rem;
                font-size: 0.9rem;
            }

            .phase-dot .phase-number {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .save-buttons {
                bottom: 1.25rem;
                right: 1.25rem;
                gap: 0.75rem;
            }

            .save-btn {
                padding: 0.85rem 1.2rem;
                font-size: 0.95rem;
            }

            .work-table th,
            .work-table td {
                padding: 0.75rem;
                font-size: 0.95rem;
            }

            .work-table input,
            .work-table textarea,
            .work-table select {
                font-size: 0.95rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0.75rem 0.5rem;
            }

            .container {
                margin: 1.2rem auto;
                padding: 0 0.75rem 5rem;
            }

            .white-card {
                padding: 1.2rem;
            }

            .table-wrapper {
                margin: 1rem 0;
            }

            .data-table {
                min-width: 480px;
            }

            .maslow-pyramid {
                gap: 0.2rem;
            }

            .pyramid-level {
                width: clamp(230px, var(--level-width), 92%);
                text-align: left;
            }

            .phase-title {
                font-size: 1.7rem;
            }

            .section-title {
                font-size: 1.35rem;
            }

            .phase-nav-list {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 0.5rem;
                margin-left: -0.5rem;
                margin-right: -0.5rem;
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }

            .phase-nav-list::-webkit-scrollbar {
                display: none;
            }

            .phase-nav-list {
                flex-wrap: nowrap;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            .phase-dot {
                padding: 0.35rem 0.85rem;
                font-size: 0.85rem;
            }

            .phase-dot .phase-number {
                width: 28px;
                height: 28px;
                font-size: 0.95rem;
            }

            .save-buttons {
                left: 1rem;
                right: auto;
                bottom: 1rem;
                gap: 0.5rem;
            }

            .save-btn {
                width: 100%;
                max-width: 220px;
                padding: 0.75rem 1rem;
                text-align: center;
            }
        }

        /* DATI STUDENTE */
        .student-info {
            margin: 2rem 0;
            padding: 1.5rem;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.08) 0%, rgba(76, 175, 80, 0.08) 100%);
            border: 1px solid rgba(33, 150, 243, 0.2);
        }

        .student-info h3 {
            color: #1a5c3a;
            margin-bottom: 1rem;
        }

        .student-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }

        .student-info label {
            display: block;
            font-weight: 600;
            color: #1a5c3a;
            margin-bottom: 0.5rem;
        }

        /* MAPPA CONCETTUALE */
        .concept-map-area {
            border: 3px dashed #1a5c3a;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            background: #f9f9f9;
            margin: 1.5rem 0;
        }

        .concept-map-area textarea {
            width: 100%;
            min-height: 200px;
            margin-top: 1rem;
        }

        /* DIAMANTE WELFARE */
        .diamond-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .diamond-box {
            background: white;
            border: 3px solid;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .diamond-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        .diamond-box.state { border-color: #2196f3; }
        .diamond-box.family { border-color: #e91e63; }
        .diamond-box.market { border-color: #ff9800; }
        .diamond-box.third-sector { border-color: #4caf50; }

        .diamond-box h4 {
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
        }

        /* QUIZ MULTIPLA */
        .quiz-question {
            background: white;
            border-left: 5px solid #2196f3;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 10px;
        }

        .quiz-question h4 {
            color: #1a5c3a;
            margin-bottom: 1rem;
        }

        .quiz-options {
            margin: 1rem 0;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: #f9f9f9;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            background: #e3f2fd;
        }

        .quiz-option input[type="radio"] {
            cursor: pointer;
        }

        /* MOBILE */
        @media (max-width: 768px) {
            .connection-row {
                grid-template-columns: 1fr;
            }
            
            .connection-arrow {
                transform: rotate(90deg);
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .work-table,
            .work-table thead,
            .work-table tbody,
            .work-table tr,
            .work-table td {
                display: block;
                width: 100%;
            }

            .work-table thead {
                display: none;
            }

            .work-table tr {
                margin-bottom: 1rem;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 1rem;
            }

            .work-table td::before {
                content: attr(data-label);
                display: block;
                font-weight: bold;
                color: #1a5c3a;
                margin-bottom: 0.5rem;
            }
        }

        /* STAMPA */
        @media print {
            body {
                background: #ffffff !important;
                color: #000000 !important;
            }

            .header {
                position: static !important;
                transform: none !important;
                opacity: 1 !important;
                box-shadow: none !important;
                background: #ffffff !important;
                color: #000000 !important;
                border-bottom: 2px solid #1a5c3a;
                padding-bottom: 1.5rem;
                margin-bottom: 1.5rem;
            }

            .header h1 {
                color: #000000 !important;
                text-shadow: none !important;
            }

            .phase-nav,
            .save-buttons,
            .save-status,
            .btn-next,
            .btn-download,
            .btn-primary,
            .btn-secondary,
            .slider-controls,
            .card-actions,
            .save-btn {
                display: none !important;
            }

            .container {
                padding: 1.5rem !important;
                margin-top: 0 !important;
            }

            .phase {
                display: block !important;
                page-break-after: always;
                break-after: page;
            }

            .phase:last-of-type {
                page-break-after: auto;
                break-after: auto;
            }

            .white-card {
                background: #ffffff !important;
                color: #000000 !important;
                box-shadow: none !important;
                border: 1px solid #dfe6e9;
            }

            .info-box {
                border-left-width: 3px;
            }

            .cards-grid {
                display: grid !important;
            }

            #cards-slider {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <h1>🎓 Il Welfare: dalle Basi all'Azione</h1>
        <p style="font-size: 1rem; opacity: 0.9;">Percorso di apprendimento in 4 fasi - Versione Integrata</p>
    </div>

    <nav class="phase-nav" aria-label="Navigazione fasi del percorso">
        <div class="phase-nav-list">
            <button class="phase-dot active" type="button" data-phase="1" onclick="goToPhase(1)">
                <span class="phase-number">1</span>
                <span class="phase-label">Scopro</span>
            </button>
            <button class="phase-dot" type="button" data-phase="2" onclick="goToPhase(2)">
                <span class="phase-number">2</span>
                <span class="phase-label">Esploro</span>
            </button>
            <button class="phase-dot" type="button" data-phase="3" onclick="goToPhase(3)">
                <span class="phase-number">3</span>
                <span class="phase-label">Applico</span>
            </button>
            <button class="phase-dot" type="button" data-phase="4" onclick="goToPhase(4)">
                <span class="phase-number">4</span>
                <span class="phase-label">Rifletto</span>
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- ================================ -->
        <!-- FASE 1: SCOPRO -->
        <!-- ================================ -->
        <div class="phase active" id="phase-1">
            <div class="white-card">
                <h2 class="phase-title">🚀 FASE 1: SCOPRO - Le Basi del Welfare</h2>
                
                <div class="info-box yellow">
                    <h3>🎯 COSA FAI ORA (5 minuti)</h3>
                    <ul>
                        <li><strong>Scrivi</strong> cosa significa per te "benessere"</li>
                        <li><strong>Leggi</strong> la definizione di welfare</li>
                        <li><strong>Studia</strong> i 3 pilastri fondamentali</li>
                        <li><strong>Scopri</strong> le tue competenze come operatore</li>
                        <li><strong>Conosci</strong> i 4 attori del welfare (Diamante)</li>
                    </ul>
                </div>

                <div class="info-box green">
                    <h3>💡 PERCHÉ LO FAI</h3>
                    <p>Devi capire le basi prima di vedere come funziona nella pratica! Questa fase ti dà il quadro generale.</p>
                </div>

                <!-- BRAINSTORMING -->
                <div class="instructions">
                    <h4>📝 Passo 1: Brainstorming iniziale</h4>
                    <ol>
                        <li><strong>Scrivi</strong> nel campo qui sotto cosa significa per te "benessere" (3-5 parole chiave)</li>
                        <li><strong>Pensa</strong> a cosa serve per vivere bene</li>
                    </ol>
                </div>

                <div class="student-info">
                    <h3>👤 I tuoi dati</h3>
                    <div class="student-info-grid">
                        <div>
                            <label for="student-name-p1">Nome e Cognome</label>
                            <input type="text" id="student-name-p1" name="student-name-p1" class="input-field" placeholder="Il tuo nome...">
                        </div>
                        <div>
                            <label for="student-class-p1">Classe</label>
                            <input type="text" id="student-class-p1" name="student-class-p1" class="input-field" placeholder="Es. 3B OSS">
                        </div>
                        <div>
                            <label for="activity-date-p1">Data</label>
                            <input type="date" id="activity-date-p1" name="activity-date-p1" class="input-field">
                        </div>
                    </div>
                </div>

                <label for="brainstorm-welfare" style="display: block; font-weight: bold; color: #1a5c3a; margin: 1rem 0 0.5rem;">
                    Per me "benessere" significa...
                </label>
                <textarea id="brainstorm-welfare" name="brainstorm-welfare" class="input-field" placeholder="Scrivi qui le tue idee (es: salute, casa, lavoro, amici...)"></textarea>

                <!-- TEORIA WELFARE -->
                <h2 class="section-title">📘 Cos'è il Welfare?</h2>
                
                <div class="instructions">
                    <h4>📖 Passo 2: Leggi la definizione</h4>
                    <ol>
                        <li><strong>Leggi</strong> con attenzione la definizione di welfare</li>
                        <li><strong>Sottolinea</strong> mentalmente le parole chiave</li>
                        <li><strong>Confronta</strong> con quello che hai scritto prima</li>
                    </ol>
                </div>

                <div class="info-box blue">
                    <p style="font-size: 1.1rem; line-height: 1.8;">
                        <strong>"Welfare"</strong> significa <strong>benessere</strong>. Il <strong>Welfare State</strong> (Stato del Benessere) 
                        è il sistema con cui lo Stato garantisce ai cittadini condizioni di vita dignitose attraverso 
                        <strong>servizi, tutele e prestazioni sociali</strong>.
                    </p>
                </div>

                <p style="margin: 1.5rem 0; font-size: 1.05rem; line-height: 1.8;">
                    Il welfare è un <strong>sistema organizzato</strong> di norme, regole e azioni che ha l'obiettivo di 
                    garantire il benessere generale dei cittadini attraverso tre aree principali:
                </p>

                <!-- TABELLA 3 PILASTRI -->
                <h3 style="color: #c41e3a; font-size: 1.5rem; margin: 2rem 0 1rem;">I Tre Pilastri del Welfare</h3>
                
                <div class="instructions">
                    <h4>🏛️ Passo 3: Studia i 3 pilastri</h4>
                    <ol>
                        <li><strong>Leggi</strong> ogni pilastro nella tabella</li>
                        <li><strong>Guarda</strong> gli esempi di servizi</li>
                        <li><strong>Pensa</strong> a quali servizi conosci nella tua città</li>
                    </ol>
                </div>

                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Pilastro</th>
                                <th>Cosa garantisce</th>
                                <th>Esempi di servizi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>🏥 Sistema Sanitario</strong></td>
                                <td>Tutela della salute e prevenzione</td>
                                <td>Ospedali, medico di base, vaccinazioni, 118, riabilitazione, salute mentale</td>
                            </tr>
                            <tr>
                                <td><strong>💰 Sistema Previdenziale</strong></td>
                                <td>Sicurezza economica</td>
                                <td>Pensioni, disoccupazione, assegni familiari, bonus bebè, invalidità</td>
                            </tr>
                            <tr>
                                <td><strong>🤝 Assistenza Sociale</strong></td>
                                <td>Supporto a persone fragili</td>
                                <td>Asili nido, assistenza domiciliare, centri disabilità, senza fissa dimora</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- NUOVO: COMPETENZE OPERATORE -->
                <h2 class="section-title">🎓 Le Tue Competenze come Operatore</h2>
                
                <div class="instructions">
                    <h4>💼 Passo 4: Scopri le competenze</h4>
                    <ol>
                        <li><strong>Leggi</strong> le tre dimensioni della competenza professionale</li>
                        <li><strong>Rifletti</strong> su quali hai già e quali devi sviluppare</li>
                        <li><strong>Compila</strong> l'autovalutazione sotto</li>
                    </ol>
                </div>

                <div class="help-characteristics">
                    <div class="characteristic-card">
                        <h4>📚 SAPERE</h4>
                        <p><strong>Conoscenze teoriche</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Normative e legislazione</li>
                            <li>Metodologie di intervento</li>
                            <li>Principi del welfare</li>
                            <li>Psicologia e sociologia</li>
                        </ul>
                    </div>
                    <div class="characteristic-card">
                        <h4>🛠️ SAPER FARE</h4>
                        <p><strong>Capacità pratiche</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Condurre colloqui</li>
                            <li>Progettare interventi</li>
                            <li>Applicare tecniche</li>
                            <li>Collaborare in équipe</li>
                        </ul>
                    </div>
                    <div class="characteristic-card">
                        <h4>❤️ SAPER ESSERE</h4>
                        <p><strong>Atteggiamenti personali</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Empatia e ascolto</li>
                            <li>Etica professionale</li>
                            <li>Gestione emotiva</li>
                            <li>Rispetto e non giudizio</li>
                        </ul>
                    </div>
                </div>

                <label style="display: block; font-weight: bold; color: #1a5c3a; margin: 1.5rem 0 0.5rem;">
                    Autovalutazione: Quali competenze hai già? Quali vuoi sviluppare?
                </label>
                <textarea id="competenze-autoval" name="competenze-autoval" class="input-field" 
                          placeholder="Esempio: Ho già sviluppato l'empatia, voglio migliorare nel condurre colloqui..."></textarea>

                <!-- NUOVO: DIAMANTE DEL WELFARE -->
                <h2 class="section-title">💎 Il Diamante del Welfare: I 4 Attori</h2>
                
                <div class="instructions">
                    <h4>🔷 Passo 5: Conosci i 4 attori</h4>
                    <ol>
                        <li><strong>Leggi</strong> il ruolo di ogni attore del welfare</li>
                        <li><strong>Nota</strong> come collaborano tra loro</li>
                        <li><strong>Pensa</strong> a esempi concreti nella tua zona</li>
                    </ol>
                </div>

                <div class="info-box blue">
                    <p>Il welfare non è solo lo Stato! Il benessere è garantito dalla collaborazione di 
                    <strong>quattro attori</strong> diversi: Stato, Famiglia, Mercato e Terzo Settore. 
                    Questo si chiama <strong>Welfare Mix</strong>.</p>
                </div>

                <div class="diamond-grid">
                    <div class="diamond-box state">
                        <h4>🏛️ STATO</h4>
                        <p><strong>Ruolo:</strong> Definisce politiche, garantisce servizi essenziali</p>
                        <p style="margin-top: 0.5rem;"><strong>Esempi:</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Sanità pubblica (SSN)</li>
                            <li>Scuola obbligatoria</li>
                            <li>Pensioni</li>
                            <li>NASpI</li>
                        </ul>
                    </div>

                    <div class="diamond-box family">
                        <h4>👨‍👩‍👧 FAMIGLIA</h4>
                        <p><strong>Ruolo:</strong> Prima rete di supporto</p>
                        <p style="margin-top: 0.5rem;"><strong>Esempi:</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Nonni che curano nipoti</li>
                            <li>Figli che sostengono genitori</li>
                            <li>Aiuti economici familiari</li>
                        </ul>
                    </div>

                    <div class="diamond-box third-sector">
                        <h4>🤝 TERZO SETTORE</h4>
                        <p><strong>Ruolo:</strong> Associazioni e volontariato</p>
                        <p style="margin-top: 0.5rem;"><strong>Esempi:</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Caritas</li>
                            <li>Croce Rossa</li>
                            <li>Cooperative sociali</li>
                        </ul>
                    </div>

                    <div class="diamond-box market">
                        <h4>💼 MERCATO</h4>
                        <p><strong>Ruolo:</strong> Produce reddito e innovazione</p>
                        <p style="margin-top: 0.5rem;"><strong>Esempi:</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Benefit aziendali</li>
                            <li>Fondi pensione privati</li>
                            <li>Polizze sanitarie</li>
                        </ul>
                    </div>
                </div>

                <label style="display: block; font-weight: bold; color: #1a5c3a; margin: 1.5rem 0 0.5rem;">
                    Esempio concreto: Pensa a una persona anziana che conosci. Quali dei 4 attori la supportano?
                </label>
                <textarea id="diamond-example" name="diamond-example" class="input-field" 
                          placeholder="Es: Lo Stato con la pensione, la famiglia con cure, il terzo settore con volontari..."></textarea>

                <!-- MAPPA CONCETTUALE INIZIALE -->
                <h3 style="color: #c41e3a; font-size: 1.5rem; margin: 3rem 0 1rem;">🗺️ La tua prima mappa concettuale</h3>
                
                <div class="instructions">
                    <h4>✏️ Passo 6: Crea la tua mappa</h4>
                    <ol>
                        <li><strong>Disegna</strong> i concetti chiave: welfare, 3 pilastri, 4 attori, competenze</li>
                        <li><strong>Scrivi</strong> esempi di servizi</li>
                        <li><strong>Usa</strong> frecce per collegare i concetti</li>
                    </ol>
                </div>

                <div class="concept-map-area">
                    <p style="font-size: 1.1rem; color: #555;">
                        💡 <strong>Disegna la tua mappa qui</strong><br>
                        (Esempio: WELFARE al centro → 3 PILASTRI → 4 ATTORI → SERVIZI → COMPETENZE OPERATORE)
                    </p>
                    <textarea id="concept-map-initial" name="concept-map-initial" class="input-field" 
                              placeholder="Scrivi qui la tua mappa usando testo e frecce (→)"></textarea>
                </div>

                <div class="info-box green" style="margin-top: 2rem;">
                    <h3>✅ Hai finito la Fase 1!</h3>
                    <p>Ora hai le basi: sai cos'è il welfare, i suoi 3 pilastri, i 4 attori e le competenze dell'operatore.</p>
                    <p style="margin-top: 0.5rem;"><strong>Prossima tappa:</strong> Vedremo come funziona nella pratica!</p>
                </div>

                <button type="button" class="btn btn-primary btn-next" onclick="completePhase(1)">
                    ✅ HAI FINITO? → VAI ALLA FASE 2: ESPLORO
                </button>
            </div>
        </div>

        <!-- ================================ -->
        <!-- FASE 2: ESPLORO -->
        <!-- ================================ -->
        <div class="phase" id="phase-2">
            <div class="white-card">
                <h2 class="phase-title">📚 FASE 2: ESPLORO - Come funziona il welfare</h2>
                
                <div class="info-box yellow">
                    <h3>🎯 COSA FAI ORA (20 minuti)</h3>
                    <ul>
                        <li><strong>Rivedi</strong> la piramide dei bisogni di Maslow</li>
                        <li><strong>Studia</strong> la relazione d'aiuto e gli strumenti dell'operatore</li>
                        <li><strong>Conosci</strong> gli enti del welfare (INPS, ASL, Comuni)</li>
                        <li><strong>Scopri</strong> le leggi fondamentali</li>
                        <li><strong>Esplora</strong> le 18 carte dei servizi welfare</li>
                        <li><strong>Risolvi</strong> i 2 scenari pratici</li>
                    </ul>
                </div>

                <div class="info-box green">
                    <h3>💡 PERCHÉ LO FAI</h3>
                    <p>Devi capire come il welfare risponde ai bisogni delle persone nella vita reale!</p>
                </div>

                <!-- MASLOW -->
                <h2 class="section-title">📺 La Piramide di Maslow e il Welfare</h2>
                
                <div class="instructions">
                    <h4>👁️ Passo 1: Osserva la piramide</h4>
                    <ol>
                        <li><strong>Leggi</strong> ogni livello di bisogno</li>
                        <li><strong>Guarda</strong> come il welfare risponde a ciascun bisogno</li>
                        <li><strong>Nota</strong> che si parte dai bisogni base (cibo, casa) per arrivare a quelli più alti</li>
                    </ol>
                </div>

                <div class="maslow-pyramid">
                    <div class="pyramid-level">
                        <h4>8️⃣ Trascendenza</h4>
                        <p><strong>Welfare:</strong> Programmi volontariato, iniziative comunitarie</p>
                    </div>
                    <div class="pyramid-level">
                        <h4>7️⃣ Auto-realizzazione</h4>
                        <p><strong>Welfare:</strong> Sviluppo professionale, coaching, crescita personale</p>
                    </div>
                    <div class="pyramid-level">
                        <h4>6️⃣ Bisogni Estetici</h4>
                        <p><strong>Welfare:</strong> Arte, cultura, eventi pubblici, spazi accoglienti</p>
                    </div>
                    <div class="pyramid-level">
                        <h4>5️⃣ Bisogni di Conoscenza</h4>
                        <p><strong>Welfare:</strong> Educazione, biblioteche, formazione continua</p>
                    </div>
                    <div class="pyramid-level">
                        <h4>4️⃣ Bisogni di Stima</h4>
                        <p><strong>Welfare:</strong> Formazione professionale, riconoscimento, opportunità</p>
                    </div>
                    <div class="pyramid-level">
                        <h4>3️⃣ Bisogni di Appartenenza</h4>
                        <p><strong>Welfare:</strong> Gruppi supporto, centri aggregazione, socializzazione</p>
                    </div>
                    <div class="pyramid-level">
                        <h4>2️⃣ Bisogni di Sicurezza</h4>
                        <p><strong>Welfare:</strong> Supporto psicologico, casa, lavoro, sicurezza sociale</p>
                    </div>
                    <div class="pyramid-level">
                        <h4>1️⃣ Bisogni Fisiologici</h4>
                        <p><strong>Welfare:</strong> Cibo, rifugi emergenza, cure sanitarie base</p>
                    </div>
                </div>

                <!-- CARATTERISTICHE RELAZIONE D'AIUTO -->
                <h2 class="section-title">❤️ La Relazione d'Aiuto</h2>
                
                <div class="instructions">
                    <h4>🤝 Passo 2: Studia le caratteristiche</h4>
                    <ol>
                        <li><strong>Leggi</strong> ogni caratteristica della relazione d'aiuto</li>
                        <li><strong>Pensa</strong> a come l'operatore deve comportarsi</li>
                        <li><strong>Ricorda</strong> che ogni servizio nasce da una relazione tra operatore e utente</li>
                    </ol>
                </div>

                <p style="margin: 1rem 0; font-size: 1.05rem;">
                    Ogni azione sociosanitaria si sviluppa in una <strong>relazione d'aiuto</strong> con queste caratteristiche:
                </p>

                <div class="help-characteristics">
                    <div class="characteristic-card">
                        <h4>❤️ Empatia</h4>
                        <p>Comprendere i sentimenti dell'altro senza giudicare</p>
                    </div>
                    <div class="characteristic-card">
                        <h4>👥 Asimmetria</h4>
                        <p>L'operatore ha competenze, l'utente porta il suo bisogno</p>
                    </div>
                    <div class="characteristic-card">
                        <h4>📋 Etica</h4>
                        <p>Rispetto della dignità e riservatezza</p>
                    </div>
                    <div class="characteristic-card">
                        <h4>🧑‍💼 Professionalità</h4>
                        <p>Competenza tecnica + capacità relazionali</p>
                    </div>
                    <div class="characteristic-card">
                        <h4>🙏 Scambio</h4>
                        <p>Anche l'operatore cresce dall'incontro</p>
                    </div>
                    <div class="characteristic-card">
                        <h4>🎁 Dono</h4>
                        <p>Tempo, ascolto e competenze per il benessere</p>
                    </div>
                </div>

                <!-- NUOVO: STRUMENTI OPERATORE -->
                <h2 class="section-title">🛠️ Gli Strumenti dell'Operatore</h2>
                
                <div class="instructions">
                    <h4>📋 Passo 3: Conosci gli strumenti</h4>
                    <ol>
                        <li><strong>Leggi</strong> le caratteristiche di colloquio e visita domiciliare</li>
                        <li><strong>Nota</strong> vantaggi e limiti di ogni strumento</li>
                        <li><strong>Rifletti</strong> su quando usare ciascuno</li>
                    </ol>
                </div>

                <div class="help-characteristics">
                    <div class="characteristic-card">
                        <h4>💬 IL COLLOQUIO</h4>
                        <p><strong>✅ Vantaggi:</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Comunicazione diretta</li>
                            <li>Esplora aspetti emotivi</li>
                            <li>Indaga motivazioni</li>
                        </ul>
                        <p style="margin-top: 0.5rem;"><strong>⚠️ Limiti:</strong></p>
                        <ul style="margin-left: 1rem;">
                            <li>Dipende dalla disponibilità</li>
                            <li>Può essere influenzato da emozioni</li>
                        </ul>
                    </div>

                    <div class="characteristic-card">
                        <h4>🏠 VISITA DOMICILIARE</h4>
                        <p><strong>✅ Vantaggi:</strong></p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Visione concreta della realtà</li>
                            <li>Osservazione diretta</li>
                            <li>Più naturale per l'utente</li>
                        </ul>
                        <p style="margin-top: 0.5rem;"><strong>⚠️ Limiti:</strong></p>
                        <ul style="margin-left: 1rem;">
                            <li>Può suscitare disagio</li>
                            <li>Questioni di privacy</li>
                        </ul>
                    </div>
                </div>

                <div class="info-box yellow">
                    <h3>💡 Tecniche per un colloquio efficace</h3>
                    <ul>
                        <li><strong>Ascolto attivo:</strong> Concentrarsi senza interrompere</li>
                        <li><strong>Domande aperte:</strong> "Come si sente?" invece di "Sta bene?"</li>
                        <li><strong>Riformulazione:</strong> Ripetere con parole proprie</li>
                        <li><strong>Empatia:</strong> Mostrare comprensione dei sentimenti</li>
                        <li><strong>Non giudizio:</strong> Accettare senza criticare</li>
                    </ul>
                </div>

                <!-- NUOVO: ENTI DEL WELFARE -->
                <h2 class="section-title">🏢 Gli Enti del Welfare</h2>
                
                <div class="instructions">
                    <h4>🎯 Passo 4: Conosci gli enti</h4>
                    <ol>
                        <li><strong>Leggi</strong> il ruolo di ogni ente</li>
                        <li><strong>Memorizza</strong> quali servizi gestisce ciascuno</li>
                        <li><strong>Compila</strong> l'esercizio sotto</li>
                    </ol>
                </div>

                <div class="help-characteristics">
                    <div class="characteristic-card">
                        <h4>💼 INPS</h4>
                        <p><strong>Istituto Nazionale Previdenza Sociale</strong></p>
                        <p style="margin-top: 0.5rem;">Gestisce:</p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Pensioni</li>
                            <li>Indennità disoccupazione</li>
                            <li>Assegni familiari</li>
                            <li>Invalidità</li>
                        </ul>
                    </div>

                    <div class="characteristic-card">
                        <h4>🏥 ASL</h4>
                        <p><strong>Aziende Sanitarie Locali</strong></p>
                        <p style="margin-top: 0.5rem;">Gestiscono:</p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Ospedali</li>
                            <li>Medici di base</li>
                            <li>Vaccinazioni</li>
                            <li>Servizi specialistici</li>
                        </ul>
                    </div>

                    <div class="characteristic-card">
                        <h4>🏛️ COMUNI</h4>
                        <p><strong>Enti Locali</strong></p>
                        <p style="margin-top: 0.5rem;">Gestiscono:</p>
                        <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                            <li>Assistenza domiciliare</li>
                            <li>Asili nido</li>
                            <li>Servizi sociali</li>
                            <li>Centri diurni</li>
                        </ul>
                    </div>
                </div>

                <label style="display: block; font-weight: bold; color: #1a5c3a; margin: 1.5rem 0 0.5rem;">
                    Esercizio: A quale ente ti rivolgi per...?
                </label>
                <div style="background: #f9f9f9; padding: 1.5rem; border-radius: 8px;">
                    <p>1. Una persona che ha perso il lavoro e cerca sostegno economico → 
                    <select id="ente-ex1" name="ente-ex1" class="input-field" style="width: auto; display: inline-block; margin-left: 0.5rem;">
                        <option value="">Seleziona...</option>
                        <option value="INPS">INPS</option>
                        <option value="ASL">ASL</option>
                        <option value="Comune">Comune</option>
                    </select></p>
                    
                    <p style="margin-top: 1rem;">2. Un anziano che ha bisogno di assistenza a casa → 
                    <select id="ente-ex2" name="ente-ex2" class="input-field" style="width: auto; display: inline-block; margin-left: 0.5rem;">
                        <option value="">Seleziona...</option>
                        <option value="INPS">INPS</option>
                        <option value="ASL">ASL</option>
                        <option value="Comune">Comune</option>
                    </select></p>
                    
                    <p style="margin-top: 1rem;">3. Una persona che deve fare una visita specialistica → 
                    <select id="ente-ex3" name="ente-ex3" class="input-field" style="width: auto; display: inline-block; margin-left: 0.5rem;">
                        <option value="">Seleziona...</option>
                        <option value="INPS">INPS</option>
                        <option value="ASL">ASL</option>
                        <option value="Comune">Comune</option>
                    </select></p>
                </div>

                <!-- NUOVO: LEGGI FONDAMENTALI -->
                <h2 class="section-title">⚖️ Leggi Fondamentali del Welfare</h2>
                
                <div class="instructions">
                    <h4>📜 Passo 5: Conosci le leggi principali</h4>
                    <ol>
                        <li><strong>Leggi</strong> ogni legge e cosa garantisce</li>
                        <li><strong>Memorizza</strong> almeno 3 leggi fondamentali</li>
                        <li><strong>Risolvi</strong> il quiz sotto</li>
                    </ol>
                </div>

                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 25%;">Legge</th>
                                <th style="width: 75%;">Cosa garantisce</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>L. 833/1978</strong></td>
                                <td>Ha istituito il <strong>Servizio Sanitario Nazionale (SSN)</strong> - assistenza sanitaria universale e gratuita</td>
                            </tr>
                            <tr>
                                <td><strong>L. 328/2000</strong></td>
                                <td><strong>Sistema Integrato di Servizi Sociali</strong> - programmazione servizi sociali a livello locale</td>
                            </tr>
                            <tr>
                                <td><strong>L. 104/1992</strong></td>
                                <td><strong>Assistenza persone con disabilità</strong> - permessi lavoro, integrazione, supporto familiare</td>
                            </tr>
                            <tr>
                                <td><strong>L. 180/1978</strong></td>
                                <td><strong>Legge Basaglia</strong> - chiusura manicomi, assistenza psichiatrica territoriale</td>
                            </tr>
                            <tr>
                                <td><strong>L. 68/1999</strong></td>
                                <td><strong>Diritto al lavoro dei disabili</strong> - quote riservate nelle assunzioni</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="quiz-question">
                    <h4>📝 Quiz: Collega la situazione alla legge corretta</h4>
                    <p><strong>Situazione:</strong> Marco ha una disabilità e cerca lavoro. Quale legge lo tutela?</p>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="quiz-legge1" value="A">
                            A) Legge 833/1978 (SSN)
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="quiz-legge1" value="B">
                            B) Legge 68/1999 (Diritto al lavoro disabili)
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="quiz-legge1" value="C">
                            C) Legge 180/1978 (Basaglia)
                        </label>
                    </div>
                    <div class="feedback" id="feedback-legge1"></div>
                </div>

                <!-- CARTE SERVIZIO -->
                <h2 class="section-title">🃏 Le 18 Carte dei Servizi Welfare</h2>
                
                <div class="instructions">
                    <h4>👀 Passo 6: Esplora le carte</h4>
                    <ol>
                        <li><strong>Scegli</strong> la visualizzazione (Griglia o Scorrimento)</li>
                        <li><strong>Leggi</strong> ogni carta: nome, descrizione, pilastro</li>
                        <li><strong>Nota</strong> il collegamento tra servizio e bisogni di Maslow</li>
                    </ol>
                </div>

                <div class="cards-container">
                    <div class="cards-controls">
                        <button class="btn btn-secondary" onclick="toggleCardsView('grid')" id="btn-grid">
                            📊 Vista Griglia
                        </button>
                        <button class="btn btn-secondary" onclick="toggleCardsView('slider')" id="btn-slider">
                            ➡️ Scorrimento
                        </button>
                    </div>

                    <div id="cards-grid" class="cards-grid"></div>
                    
                    <div id="cards-slider" class="cards-slider">
                        <div id="current-card"></div>
                        <div class="slider-controls">
                            <button class="slider-btn" id="prev-btn" onclick="changeCard(-1)">⬅️ Prec</button>
                            <div class="slider-counter">
                                <span id="card-counter">1</span> / 18
                            </div>
                            <button class="slider-btn" id="next-btn" onclick="changeCard(1)">Succ ➡️</button>
                        </div>
                    </div>
                </div>

                <!-- SCENARI -->
                <h2 class="section-title">🎭 Laboratorio: Scenari Reali</h2>
                
                <div class="instructions">
                    <h4>📝 Passo 7: Risolvi gli scenari</h4>
                    <ol>
                        <li><strong>Leggi</strong> attentamente ogni scenario</li>
                        <li><strong>Individua</strong> i bisogni delle persone</li>
                        <li><strong>Pensa</strong> a quali servizi del welfare possono aiutare</li>
                        <li><strong>Scrivi</strong> le tue risposte nei campi</li>
                    </ol>
                </div>

                <div class="scenario-card">
                    <h4>Scenario 1 – Maria, 78 anni</h4>
                    <p>Maria vive sola e rientra a casa dopo una frattura al femore. Ha dolore, si muove con il deambulatore e teme di cadere di nuovo.</p>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1rem;">
                        Quali bisogni ha Maria? (usa la piramide di Maslow)
                    </label>
                    <textarea id="scenario1-needs" name="scenario1-needs" class="input-field" 
                              placeholder="Es: Bisogni fisiologici (movimento), sicurezza (paura cadute), appartenenza..."></textarea>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1rem;">
                        Quali servizi del welfare possono aiutarla?
                    </label>
                    <textarea id="scenario1-services" name="scenario1-services" class="input-field" 
                              placeholder="Es: Assistenza domiciliare, fisioterapia, telesoccorso..."></textarea>
                </div>

                <div class="scenario-card">
                    <h4>Scenario 2 – Yara, 16 anni</h4>
                    <p>Yara frequenta il CFP ma mostra calo motivazionale, assenze frequenti e conflitti familiari.</p>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1rem;">
                        Quali bisogni ha Yara?
                    </label>
                    <textarea id="scenario2-needs" name="scenario2-needs" class="input-field" 
                              placeholder="Es: Appartenenza (relazioni), stima (successo scolastico), conoscenza..."></textarea>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1rem;">
                        Quali servizi e quali strumenti usa l'operatore?
                    </label>
                    <textarea id="scenario2-services" name="scenario2-services" class="input-field" 
                              placeholder="Es: Colloquio motivazionale, supporto psicologico, patto educativo..."></textarea>
                </div>

                <div class="info-box green" style="margin-top: 2rem;">
                    <h3>✅ Hai finito la Fase 2!</h3>
                    <p>Ora sai come i servizi rispondono ai bisogni, conosci gli enti e le leggi fondamentali, e hai visto esempi concreti.</p>
                    <p style="margin-top: 0.5rem;"><strong>Prossima tappa:</strong> Mettere in pratica i collegamenti!</p>
                </div>

                <button type="button" class="btn btn-primary btn-next" onclick="completePhase(2)">
                    ✅ HAI FINITO? → VAI ALLA FASE 3: APPLICO
                </button>
            </div>
        </div>

        <!-- ================================ -->
        <!-- FASE 3: APPLICO -->
        <!-- ================================ -->
        <div class="phase" id="phase-3">
            <div class="white-card">
                <h2 class="phase-title">🛠️ FASE 3: APPLICO - Faccio i collegamenti</h2>
                
                <div class="info-box yellow">
                    <h3>🎯 COSA FAI ORA (25 minuti)</h3>
                    <ul>
                        <li><strong>Completa</strong> i 6 esercizi di collegamento bisogni-servizi-pilastri</li>
                        <li><strong>Risolvi</strong> il quiz sui modelli di welfare</li>
                        <li><strong>Compila</strong> la tabella di analisi servizi</li>
                        <li><strong>Presenta</strong> il tuo lavoro al gruppo</li>
                    </ul>
                </div>

                <div class="info-box green">
                    <h3>💡 PERCHÉ LO FAI</h3>
                    <p>È qui che impari davvero: collegando bisogni → servizi → pilastri e applicando la teoria alla pratica!</p>
                </div>

                <!-- COLLEGAMENTI -->
                <h2 class="section-title">🔗 Mappa dei Collegamenti</h2>
                
                <div class="instructions">
                    <h4>🎯 Passo 1: Completa gli esercizi</h4>
                    <ol>
                        <li><strong>Leggi</strong> il bisogno della persona</li>
                        <li><strong>Seleziona</strong> quale servizio risponde a quel bisogno</li>
                        <li><strong>Scegli</strong> quale pilastro offre quel servizio</li>
                        <li><strong>Verifica</strong> se è corretto (diventa verde)</li>
                    </ol>
                </div>

                <div id="connections-container"></div>

                <!-- NUOVO: QUIZ MODELLI WELFARE -->
                <h2 class="section-title">🌍 Esercizio: Riconosci i Modelli di Welfare</h2>
                
                <div class="instructions">
                    <h4>📊 Passo 2: Modelli di welfare</h4>
                    <ol>
                        <li><strong>Leggi</strong> ogni domanda sui modelli di welfare</li>
                        <li><strong>Ricorda</strong> le caratteristiche: Selettività vs Universalità</li>
                        <li><strong>Rispondi</strong> alle domande quiz</li>
                    </ol>
                </div>

                <div class="info-box blue">
                    <h3>💡 Ricorda:</h3>
                    <ul>
                        <li><strong>Modello Selettivo:</strong> Servizi solo per chi ha certi requisiti (es. reddito basso)</li>
                        <li><strong>Modello Universale:</strong> Servizi per tutti i cittadini, senza limitazioni</li>
                    </ul>
                </div>

                <div class="quiz-question">
                    <h4>Quiz 1: Un sistema che offre sanità gratuita a TUTTI i cittadini, ricchi o poveri, è...</h4>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="quiz-modello1" value="A" onchange="checkQuizModello(1, 'A')">
                            A) Modello Selettivo
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="quiz-modello1" value="B" onchange="checkQuizModello(1, 'B')">
                            B) Modello Universale
                        </label>
                    </div>
                    <div class="feedback" id="feedback-modello1"></div>
                </div>

                <div class="quiz-question">
                    <h4>Quiz 2: Un bonus economico dato SOLO alle famiglie con reddito sotto i 20.000€ è...</h4>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="quiz-modello2" value="A" onchange="checkQuizModello(2, 'A')">
                            A) Modello Selettivo
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="quiz-modello2" value="B" onchange="checkQuizModello(2, 'B')">
                            B) Modello Universale
                        </label>
                    </div>
                    <div class="feedback" id="feedback-modello2"></div>
                </div>

                <div class="quiz-question">
                    <h4>Quiz 3: Quale modello rischia maggiormente di creare stigmatizzazione?</h4>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="quiz-modello3" value="A" onchange="checkQuizModello(3, 'A')">
                            A) Modello Selettivo
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="quiz-modello3" value="B" onchange="checkQuizModello(3, 'B')">
                            B) Modello Universale
                        </label>
                    </div>
                    <div class="feedback" id="feedback-modello3"></div>
                </div>

                <label style="display: block; font-weight: bold; color: #1a5c3a; margin: 2rem 0 0.5rem;">
                    Riflessione: Quale modello preferisci e perché?
                </label>
                <textarea id="modello-riflessione" name="modello-riflessione" class="input-field" 
                          placeholder="Spiega quale modello secondo te è migliore e perché..."></textarea>

                <!-- LAVORO DI GRUPPO -->
                <h2 class="section-title">👥 Lavoro di Gruppo: Analisi Servizi</h2>
                
                <div class="instructions">
                    <h4>📋 Passo 3: Compila la tabella</h4>
                    <ol>
                        <li><strong>Scegli</strong> un servizio del welfare</li>
                        <li><strong>Identifica</strong> a quale bisogno di Maslow risponde</li>
                        <li><strong>Scrivi</strong> il pilastro di appartenenza</li>
                        <li><strong>Spiega</strong> perché è essenziale</li>
                        <li><strong>Clicca</strong> "+ Aggiungi servizio" per analizzarne altri</li>
                    </ol>
                </div>

                <div class="student-info">
                    <h3>👤 Dati del gruppo</h3>
                    <div class="student-info-grid">
                        <div>
                            <label for="group-members">Componenti del gruppo</label>
                            <input type="text" id="group-members" name="group-members" class="input-field" 
                                   placeholder="Nomi degli studenti del gruppo...">
                        </div>
                        <div>
                            <label for="group-class">Classe</label>
                            <input type="text" id="group-class" name="group-class" class="input-field" placeholder="Es. 3B OSS">
                        </div>
                        <div>
                            <label for="group-date">Data</label>
                            <input type="date" id="group-date" name="group-date" class="input-field">
                        </div>
                    </div>
                </div>

                <table class="work-table" id="work-table">
                    <thead>
                        <tr>
                            <th>Servizio</th>
                            <th>Bisogno Maslow</th>
                            <th>Pilastro</th>
                            <th>Beneficiari</th>
                            <th>Perché essenziale</th>
                        </tr>
                    </thead>
                    <tbody id="work-tbody">
                        <tr>
                            <td data-label="Servizio">
                                <input type="text" class="work-input" data-field="servizio" 
                                       placeholder="Nome del servizio...">
                            </td>
                            <td data-label="Bisogno Maslow">
                                <select class="work-input" data-field="bisogno_maslow">
                                    <option value="">Seleziona...</option>
                                    <option value="Fisiologici">1. Fisiologici</option>
                                    <option value="Sicurezza">2. Sicurezza</option>
                                    <option value="Appartenenza">3. Appartenenza</option>
                                    <option value="Stima">4. Stima</option>
                                    <option value="Conoscenza">5. Conoscenza</option>
                                    <option value="Estetici">6. Estetici</option>
                                    <option value="Auto-realizzazione">7. Auto-realizzazione</option>
                                    <option value="Trascendenza">8. Trascendenza</option>
                                </select>
                            </td>
                            <td data-label="Pilastro">
                                <select class="work-input" data-field="pilastro">
                                    <option value="">Seleziona...</option>
                                    <option value="Sanità">🏥 Sanità</option>
                                    <option value="Previdenza">💰 Previdenza</option>
                                    <option value="Assistenza">🤝 Assistenza Sociale</option>
                                </select>
                            </td>
                            <td data-label="Beneficiari">
                                <textarea class="work-input" data-field="beneficiari" 
                                          placeholder="Chi ne beneficia..."></textarea>
                            </td>
                            <td data-label="Perché essenziale">
                                <textarea class="work-input" data-field="essenziale" 
                                          placeholder="Perché è essenziale..."></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <button class="btn btn-secondary" onclick="addWorkRow()" style="margin-top: 1rem;">
                    ➕ Aggiungi servizio
                </button>

                <!-- PRESENTAZIONE -->
                <h2 class="section-title">🎤 Presentazione dei risultati</h2>
                
                <div class="instructions">
                    <h4>🗣️ Passo 4: Prepara la presentazione</h4>
                    <ol>
                        <li><strong>Scegli</strong> i 3 servizi più importanti che avete analizzato</li>
                        <li><strong>Prepara</strong> una breve presentazione (3 minuti)</li>
                        <li><strong>Spiega</strong> il collegamento bisogno → servizio → pilastro</li>
                        <li><strong>Presenta</strong> alla classe</li>
                    </ol>
                </div>

                <label style="display: block; font-weight: bold; margin-top: 1rem;">
                    Note per la presentazione
                </label>
                <textarea id="presentation-notes" name="presentation-notes" class="input-field" 
                          placeholder="Scrivi qui i punti chiave della tua presentazione..."></textarea>

                <div class="info-box green" style="margin-top: 2rem;">
                    <h3>✅ Hai finito la Fase 3!</h3>
                    <p>Hai messo in pratica tutti i collegamenti, analizzato i modelli di welfare e creato una vera analisi dei servizi.</p>
                    <p style="margin-top: 0.5rem;"><strong>Ultima tappa:</strong> Riflettere su cosa hai imparato!</p>
                </div>

                <button type="button" class="btn btn-primary btn-next" onclick="completePhase(3)">
                    ✅ HAI FINITO? → VAI ALLA FASE 4: RIFLETTO
                </button>
            </div>
        </div>

        <!-- ================================ -->
        <!-- FASE 4: RIFLETTO -->
        <!-- ================================ -->
        <div class="phase" id="phase-4">
            <div class="white-card">
                <h2 class="phase-title">💡 FASE 4: RIFLETTO - Cosa ho imparato</h2>
                
                <div class="info-box yellow">
                    <h3>🎯 COSA FAI ORA (20 minuti)</h3>
                    <ul>
                        <li><strong>Rispondi</strong> alle domande di riflessione</li>
                        <li><strong>Autovaluta</strong> le competenze acquisite</li>
                        <li><strong>Crea</strong> la mappa concettuale finale</li>
                        <li><strong>Progetta</strong> un intervento reale completo</li>
                    </ul>
                </div>

                <div class="info-box green">
                    <h3>💡 PERCHÉ LO FAI</h3>
                    <p>La riflessione ti fa capire cosa hai davvero imparato e come puoi usarlo nella tua futura professione!</p>
                </div>

                <!-- RIFLESSIONE -->
                <h2 class="section-title">📝 Riflessione Individuale</h2>
                
                <div class="instructions">
                    <h4>🤔 Passo 1: Rispondi alle domande</h4>
                    <ol>
                        <li><strong>Pensa</strong> a tutto quello che hai fatto nelle 4 fasi</li>
                        <li><strong>Scrivi</strong> risposte sincere e personali</li>
                        <li><strong>Spiega</strong> con esempi concreti</li>
                    </ol>
                </div>

                <div class="student-info">
                    <h3>👤 I tuoi dati</h3>
                    <div class="student-info-grid">
                        <div>
                            <label for="reflection-name">Nome e Cognome</label>
                            <input type="text" id="reflection-name" name="reflection-name" class="input-field">
                        </div>
                        <div>
                            <label for="reflection-class">Classe</label>
                            <input type="text" id="reflection-class" name="reflection-class" class="input-field">
                        </div>
                        <div>
                            <label for="reflection-date">Data</label>
                            <input type="date" id="reflection-date" name="reflection-date" class="input-field">
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        1. Tre collegamenti importanti che ho imparato
                    </label>
                    <input type="text" id="learned1" name="learned1" class="input-field" 
                           placeholder="Primo collegamento..." style="margin-bottom: 0.5rem;">
                    <input type="text" id="learned2" name="learned2" class="input-field" 
                           placeholder="Secondo collegamento..." style="margin-bottom: 0.5rem;">
                    <input type="text" id="learned3" name="learned3" class="input-field" 
                           placeholder="Terzo collegamento...">
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        2. Un servizio che pensavo fosse di un pilastro ma in realtà è di un altro. Perché mi sono confuso/a?
                    </label>
                    <textarea id="misconception" name="misconception" class="input-field"></textarea>
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        3. Quale livello di Maslow è più difficile da soddisfare con il welfare? Perché?
                    </label>
                    <textarea id="maslow-difficulty" name="maslow-difficulty" class="input-field"></textarea>
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        4. Esempio concreto: come l'operatore usa le sue competenze (sapere, saper fare, saper essere)
                    </label>
                    <textarea id="operator-example" name="operator-example" class="input-field"></textarea>
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        5. Come i 4 attori del welfare (Stato, Famiglia, Mercato, Terzo Settore) lavorano insieme?
                    </label>
                    <textarea id="network-collaboration" name="network-collaboration" class="input-field"></textarea>
                </div>

                <!-- NUOVO: AUTOVALUTAZIONE COMPETENZE -->
                <h2 class="section-title">📊 Autovalutazione Competenze Acquisite</h2>
                
                <div class="instructions">
                    <h4>✅ Passo 2: Valuta le tue competenze</h4>
                    <ol>
                        <li><strong>Rileggi</strong> le competenze viste in Fase 1</li>
                        <li><strong>Valuta</strong> quanto hai sviluppato ciascuna</li>
                        <li><strong>Sii onesto</strong> con te stesso</li>
                    </ol>
                </div>

                <div style="background: #f9f9f9; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
                    <h4 style="color: #1a5c3a; margin-bottom: 1rem;">📚 SAPERE (conoscenze teoriche)</h4>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-pilastri" name="comp-pilastri"> 
                        Conosco i 3 pilastri del welfare
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-maslow" name="comp-maslow"> 
                        So usare la piramide di Maslow
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-enti" name="comp-enti"> 
                        Conosco gli enti (INPS, ASL, Comuni)
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-leggi" name="comp-leggi"> 
                        Conosco le leggi fondamentali
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-modelli" name="comp-modelli"> 
                        Comprendo i modelli di welfare
                    </label>
                </div>

                <div style="background: #f9f9f9; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
                    <h4 style="color: #1a5c3a; margin-bottom: 1rem;">🛠️ SAPER FARE (capacità pratiche)</h4>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-collegamenti" name="comp-collegamenti"> 
                        So collegare bisogni → servizi → pilastri
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-analisi" name="comp-analisi"> 
                        So analizzare situazioni reali
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-strumenti" name="comp-strumenti"> 
                        Conosco gli strumenti dell'operatore (colloquio, visita)
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-progetto" name="comp-progetto"> 
                        So progettare un intervento
                    </label>
                </div>

                <div style="background: #f9f9f9; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
                    <h4 style="color: #1a5c3a; margin-bottom: 1rem;">❤️ SAPER ESSERE (atteggiamenti)</h4>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-empatia" name="comp-empatia"> 
                        Ho sviluppato empatia
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-ascolto" name="comp-ascolto"> 
                        So ascoltare attivamente
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-etica" name="comp-etica"> 
                        Ho compreso l'importanza dell'etica
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="checkbox" id="comp-riflessione" name="comp-riflessione"> 
                        So riflettere sulla mia pratica
                    </label>
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        6. Quale competenza devo ancora sviluppare maggiormente?
                    </label>
                    <textarea id="competenza-sviluppare" name="competenza-sviluppare" class="input-field" 
                              placeholder="Scrivi quale competenza vuoi migliorare e come pensi di farlo..."></textarea>
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        7. Autovalutazione: quanto ho partecipato?
                    </label>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; padding: 1rem; background: #f9f9f9; border-radius: 8px;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="participation" value="1"> 1 - Poco
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="participation" value="2"> 2 - Insufficiente
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="participation" value="3"> 3 - Sufficiente
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="participation" value="4"> 4 - Buono
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="participation" value="5"> 5 - Ottimo
                        </label>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <label style="display: block; font-weight: bold; color: #1a5c3a; margin-bottom: 0.5rem;">
                        8. Quale aspetto dell'attività mi ha aiutato di più?
                    </label>
                    <textarea id="helpful-aspect" name="helpful-aspect" class="input-field"></textarea>
                </div>

                <!-- MAPPA CONCETTUALE FINALE -->
                <h2 class="section-title">🗺️ Mappa Concettuale Finale</h2>
                
                <div class="instructions">
                    <h4>🎨 Passo 3: Crea la mappa finale</h4>
                    <ol>
                        <li><strong>Confronta</strong> con la mappa iniziale (Fase 1)</li>
                        <li><strong>Aggiungi</strong> tutti i collegamenti che hai imparato</li>
                        <li><strong>Rendi</strong> più completa e dettagliata</li>
                    </ol>
                </div>

                <div class="info-box blue">
                    <h3>💡 Cosa inserire nella mappa finale</h3>
                    <ul>
                        <li>I 3 pilastri del welfare</li>
                        <li>I 4 attori (Diamante)</li>
                        <li>I livelli di Maslow più importanti</li>
                        <li>Esempi di servizi specifici</li>
                        <li>Collegamenti tra bisogni e servizi</li>
                        <li>Gli enti (INPS, ASL, Comuni)</li>
                        <li>Il ruolo dell'operatore e le sue competenze</li>
                        <li>Gli strumenti dell'operatore</li>
                    </ul>
                </div>

                <div class="concept-map-area">
                    <p style="font-size: 1.1rem; color: #555;">
                        🎨 <strong>La tua mappa concettuale completa</strong>
                    </p>
                    <textarea id="concept-map-final" name="concept-map-final" class="input-field" 
                              placeholder="Crea qui la tua mappa finale, molto più ricca della iniziale..."></textarea>
                </div>

                <!-- PROGETTO FINALE -->
                <h2 class="section-title">🚀 Compito Finale: Progetta un Intervento Completo</h2>
                
                <div class="instructions">
                    <h4>📋 Passo 4: Progetta un intervento reale</h4>
                    <ol>
                        <li><strong>Scegli</strong> una situazione di bisogno (es: anziano solo, famiglia in difficoltà...)</li>
                        <li><strong>Identifica</strong> i bisogni secondo Maslow</li>
                        <li><strong>Seleziona</strong> i servizi welfare (indicando pilastri ed enti)</li>
                        <li><strong>Descrivi</strong> strumenti e competenze dell'operatore</li>
                        <li><strong>Spiega</strong> come coinvolgere i 4 attori del welfare</li>
                    </ol>
                </div>

                <div style="background: #f9f9f9; padding: 2rem; border-radius: 10px; margin: 2rem 0;">
                    <h3 style="color: #1a5c3a; margin-bottom: 1rem;">Il tuo progetto di intervento completo</h3>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1.5rem;">
                        Situazione / Persona in difficoltà
                    </label>
                    <textarea id="project-situation" name="project-situation" class="input-field" 
                              placeholder="Descrivi la situazione..."></textarea>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1.5rem;">
                        Bisogni identificati (usa Maslow)
                    </label>
                    <textarea id="project-needs" name="project-needs" class="input-field" 
                              placeholder="Quali bisogni ha questa persona?"></textarea>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1.5rem;">
                        Servizi welfare da attivare (indica pilastro ed ente)
                    </label>
                    <textarea id="project-services" name="project-services" class="input-field" 
                              placeholder="Es: Assistenza domiciliare (Pilastro: Assistenza Sociale, Ente: Comune)..."></textarea>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1.5rem;">
                        Strumenti e competenze dell'operatore
                    </label>
                    <textarea id="project-actions" name="project-actions" class="input-field" 
                              placeholder="Quali strumenti usi (colloquio, visita...)? Quali competenze (sapere, saper fare, saper essere)?"></textarea>
                    
                    <label style="display: block; font-weight: bold; margin-top: 1.5rem;">
                        Come coinvolgi i 4 attori del welfare (Diamante)
                    </label>
                    <textarea id="project-networks" name="project-networks" class="input-field" 
                              placeholder="STATO (es: ASL per cure), FAMIGLIA (es: figlia), TERZO SETTORE (es: volontari), MERCATO (es: benefit aziendali)..."></textarea>
                </div>

                <div class="info-box green" style="margin-top: 3rem;">
                    <h3>🎉 COMPLIMENTI! Hai completato tutte le 4 fasi!</h3>
                    <p style="margin-top: 1rem;">
                        Ora hai una conoscenza completa del welfare: sai cos'è, come funziona, i suoi attori, 
                        come fare i collegamenti, le tue competenze professionali, e sei capace di progettare 
                        un intervento reale completo.
                    </p>
                    <p style="margin-top: 1rem; font-weight: bold;">
                        📄 Ricordati di stampare e consegnare il tuo lavoro al docente!
                    </p>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-primary" onclick="printWork()" style="font-size: 1.1rem;">
                        🖨️ STAMPA PER CONSEGNA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="save-status" id="save-status">✓ Salvato</div>

    <script>
        // ========== DATI ==========
        const servicesData = [
            { title: "Ospedali pubblici", description: "Cure specialistiche e ricoveri", pillar: "🏥 Sanità", need: "Risponde ai bisogni fisiologici (salute fisica) e di sicurezza (protezione dalla malattia)" },
            { title: "Medico di famiglia", description: "Cure di base e prevenzione", pillar: "🏥 Sanità", need: "Risponde ai bisogni fisiologici (salute) e di sicurezza (monitoraggio continuo)" },
            { title: "Vaccinazioni e screening", description: "Prevenzione e diagnosi precoce", pillar: "🏥 Sanità", need: "Risponde ai bisogni di sicurezza (prevenzione malattie)" },
            { title: "Centri di riabilitazione", description: "Recupero fisico e funzionale", pillar: "🏥 Sanità", need: "Risponde ai bisogni fisiologici (recupero fisico) e di stima (recupero autonomia)" },
            { title: "Servizi di salute mentale", description: "Supporto psicologico e psichiatrico", pillar: "🏥 Sanità", need: "Risponde ai bisogni di sicurezza (equilibrio psicologico) e di stima (benessere emotivo)" },
            { title: "Assistenza domiciliare anziani", description: "Cura a casa per persone fragili", pillar: "🤝 Assistenza Sociale", need: "Risponde ai bisogni fisiologici (cura quotidiana) e di appartenenza (non isolamento)" },
            { title: "Pensione di vecchiaia", description: "Reddito per chi non lavora più", pillar: "💰 Previdenza", need: "Risponde ai bisogni fisiologici (sostentamento) e di sicurezza (stabilità economica)" },
            { title: "Indennità di disoccupazione", description: "Sostegno a chi perde il lavoro", pillar: "💰 Previdenza", need: "Risponde ai bisogni di sicurezza (protezione economica temporanea)" },
            { title: "Assegni familiari / Bonus bebè", description: "Aiuto economico alle famiglie", pillar: "💰 Previdenza", need: "Risponde ai bisogni fisiologici (cura figli) e di appartenenza (sostegno famiglia)" },
            { title: "Indennità per non autosufficienza", description: "Contributi per persone con disabilità", pillar: "💰 Previdenza", need: "Risponde ai bisogni fisiologici (cure necessarie) e di sicurezza (copertura spese)" },
            { title: "Asili nido", description: "Cura ed educazione per l'infanzia", pillar: "🤝 Assistenza Sociale", need: "Risponde ai bisogni di appartenenza (socializzazione) e conoscenza (educazione precoce)" },
            { title: "Centri per persone con disabilità", description: "Inclusione e riabilitazione", pillar: "🤝 Assistenza Sociale", need: "Risponde ai bisogni di appartenenza (inclusione sociale) e stima (riconoscimento abilità)" },
            { title: "Servizi per senza fissa dimora", description: "Accoglienza e pasti", pillar: "🤝 Assistenza Sociale", need: "Risponde ai bisogni fisiologici (cibo, riparo) e di sicurezza (protezione)" },
            { title: "Corsi di formazione professionale", description: "Riqualificazione e reinserimento", pillar: "🤝 Assistenza Sociale", need: "Risponde ai bisogni di conoscenza (apprendimento) e auto-realizzazione (crescita)" },
            { title: "Reddito di cittadinanza", description: "Sostegno economico minimo", pillar: "💰 Previdenza", need: "Risponde ai bisogni fisiologici (sostentamento di base) e di sicurezza (dignità)" },
            { title: "Corsi di lingua per immigrati", description: "Inclusione socio-lavorativa", pillar: "🤝 Assistenza Sociale", need: "Risponde ai bisogni di appartenenza (integrazione) e conoscenza (lingua)" },
            { title: "Programmi contro le dipendenze", description: "Prevenzione e riabilitazione", pillar: "🏥 Sanità", need: "Risponde ai bisogni di sicurezza (salute) e auto-realizzazione (recupero vita)" },
            { title: "Centri diurni territoriali", description: "Supporto e socializzazione", pillar: "🤝 Assistenza Sociale", need: "Risponde ai bisogni di appartenenza (comunità) e stima (partecipazione)" }
        ];

        const connectionExercises = [
            { need: "Persona anziana sola che ha difficoltà a muoversi e fare la spesa", correctService: "Assistenza domiciliare anziani", correctPillar: "🤝 Assistenza Sociale", options: { services: ["Assistenza domiciliare anziani", "Pensione di vecchiaia", "Ospedali pubblici"], pillars: ["🤝 Assistenza Sociale", "💰 Previdenza", "🏥 Sanità"] }},
            { need: "Famiglia con neonato che non può permettersi il latte artificiale", correctService: "Assegni familiari / Bonus bebè", correctPillar: "💰 Previdenza", options: { services: ["Assegni familiari / Bonus bebè", "Asili nido", "Medico di famiglia"], pillars: ["💰 Previdenza", "🤝 Assistenza Sociale", "🏥 Sanità"] }},
            { need: "Persona disoccupata che cerca lavoro ma non ha reddito", correctService: "Indennità di disoccupazione", correctPillar: "💰 Previdenza", options: { services: ["Indennità di disoccupazione", "Corsi di formazione professionale", "Centri diurni territoriali"], pillars: ["💰 Previdenza", "🤝 Assistenza Sociale", "🏥 Sanità"] }},
            { need: "Bambino che necessita di socializzare con altri coetanei mentre i genitori lavorano", correctService: "Asili nido", correctPillar: "🤝 Assistenza Sociale", options: { services: ["Asili nido", "Assegni familiari / Bonus bebè", "Medico di famiglia"], pillars: ["🤝 Assistenza Sociale", "💰 Previdenza", "🏥 Sanità"] }},
            { need: "Persona con dipendenza da sostanze che vuole uscirne", correctService: "Programmi contro le dipendenze", correctPillar: "🏥 Sanità", options: { services: ["Programmi contro le dipendenze", "Servizi di salute mentale", "Centri diurni territoriali"], pillars: ["🏥 Sanità", "🤝 Assistenza Sociale", "💰 Previdenza"] }},
            { need: "Immigrato che non parla italiano e cerca lavoro", correctService: "Corsi di lingua per immigrati", correctPillar: "🤝 Assistenza Sociale", options: { services: ["Corsi di lingua per immigrati", "Corsi di formazione professionale", "Reddito di cittadinanza"], pillars: ["🤝 Assistenza Sociale", "💰 Previdenza", "🏥 Sanità"] }}
        ];

        let currentCardIndex = 0;
        let currentPhase = 1;

        function initHeaderHideOnScroll() {
            // Il titolo resta visibile solo all'inizio: non servono animazioni di scomparsa.
        }

        function enablePrintMode() {
            const body = document.body;
            const header = document.querySelector('.header');
            const cardsGrid = document.getElementById('cards-grid');
            const cardsSlider = document.getElementById('cards-slider');

            const previousGridDisplay = cardsGrid ? cardsGrid.style.display : '';
            const previousSliderDisplay = cardsSlider ? cardsSlider.style.display : '';
            const headerWasHidden = header ? header.classList.contains('header-hidden') : false;

            body.classList.add('print-mode');

            if (header) {
                header.classList.remove('header-hidden');
            }
            if (cardsGrid) {
                cardsGrid.style.display = 'grid';
            }
            if (cardsSlider) {
                cardsSlider.style.display = 'none';
            }

            return () => {
                body.classList.remove('print-mode');
                if (header && headerWasHidden) {
                    header.classList.add('header-hidden');
                }
                if (cardsGrid) {
                    cardsGrid.style.display = previousGridDisplay;
                }
                if (cardsSlider) {
                    cardsSlider.style.display = previousSliderDisplay;
                }
            };
        }

        // ========== NAVIGAZIONE FASI ==========
        function goToPhase(phaseNumber) {
            const phases = Array.from(document.querySelectorAll('.phase'));
            if (!phases.length) {
                return;
            }

            const maxPhase = phases.length;
            const targetPhase = Math.min(Math.max(parseInt(phaseNumber, 10) || 1, 1), maxPhase);

            phases.forEach(p => p.classList.remove('active'));
            let target = document.getElementById('phase-' + targetPhase);
            if (!target) {
                target = document.getElementById('phase-1');
            }
            if (target) {
                target.classList.add('active');
            } else if (phases.length) {
                phases[0].classList.add('active');
            }

            document.querySelectorAll('.phase-dot').forEach(dot => {
                dot.classList.remove('active', 'completed');
                const dotPhase = parseInt(dot.dataset.phase);
                if (dotPhase < targetPhase) {
                    dot.classList.add('completed');
                } else if (dotPhase === targetPhase) {
                    dot.classList.add('active');
                }
            });
            
            currentPhase = targetPhase;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            saveData();
        }

        function completePhase(phaseNumber) {
            const totalPhases = document.querySelectorAll('.phase').length || 1;
            if (phaseNumber >= totalPhases) {
                goToPhase(totalPhases);
                return;
            }
            goToPhase(phaseNumber + 1);
        }

        // ========== CARTE SERVIZIO ==========
        function generateCards() {
            const gridContainer = document.getElementById('cards-grid');
            servicesData.forEach((service, index) => {
                const card = createCardElement(service, index);
                gridContainer.appendChild(card);
            });
            updateSliderCard();
        }

        function createCardElement(service, index) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-title">${index + 1}. ${service.title}</div>
                <div class="card-description">${service.description}</div>
                <div class="card-pillar">${service.pillar}</div>
                <div class="card-need">
                    <strong>🔗 Collegamento:</strong>
                    <p style="margin: 0.5rem 0 0; color: #555; font-size: 0.95rem;">${service.need}</p>
                </div>
            `;
            return card;
        }

        function toggleCardsView(view) {
            const grid = document.getElementById('cards-grid');
            const slider = document.getElementById('cards-slider');
            const btnGrid = document.getElementById('btn-grid');
            const btnSlider = document.getElementById('btn-slider');
            
            if (view === 'grid') {
                grid.style.display = 'grid';
                slider.classList.remove('active');
                btnGrid.style.opacity = '1';
                btnSlider.style.opacity = '0.7';
            } else {
                grid.style.display = 'none';
                slider.classList.add('active');
                btnGrid.style.opacity = '0.7';
                btnSlider.style.opacity = '1';
            }
        }

        function updateSliderCard() {
            const container = document.getElementById('current-card');
            const service = servicesData[currentCardIndex];
            container.innerHTML = '';
            container.appendChild(createCardElement(service, currentCardIndex));
            
            document.getElementById('card-counter').textContent = currentCardIndex + 1;
            document.getElementById('prev-btn').disabled = currentCardIndex === 0;
            document.getElementById('next-btn').disabled = currentCardIndex === servicesData.length - 1;
        }

        function changeCard(direction) {
            currentCardIndex += direction;
            if (currentCardIndex < 0) currentCardIndex = 0;
            if (currentCardIndex >= servicesData.length) currentCardIndex = servicesData.length - 1;
            updateSliderCard();
        }

        // ========== COLLEGAMENTI ==========
        function generateConnectionExercises() {
            const container = document.getElementById('connections-container');
            connectionExercises.forEach((exercise, index) => {
                const item = document.createElement('div');
                item.className = 'connection-item';
                item.id = 'connection-' + index;
                
                item.innerHTML = `
                    <h3 style="color: #1a5c3a; margin-bottom: 1rem;">Esercizio ${index + 1}</h3>
                    <div class="connection-row">
                        <div class="connection-box need">
                            <div>
                                <strong>🚨 BISOGNO</strong><br>
                                <span style="font-size: 0.9rem;">${exercise.need}</span>
                            </div>
                        </div>
                        <div class="connection-arrow">→</div>
                        <div class="connection-box service">
                            <div style="width: 100%;">
                                <strong>🎯 SERVIZIO</strong><br>
                                <select class="connection-select" data-index="${index}" data-type="service" onchange="checkConnection(${index})">
                                    <option value="">Seleziona...</option>
                                    ${exercise.options.services.map(s => `<option value="${s}">${s}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        <div class="connection-arrow">→</div>
                        <div class="connection-box pillar">
                            <div style="width: 100%;">
                                <strong>🏛️ PILASTRO</strong><br>
                                <select class="connection-select" data-index="${index}" data-type="pillar" onchange="checkConnection(${index})">
                                    <option value="">Seleziona...</option>
                                    ${exercise.options.pillars.map(p => `<option value="${p}">${p}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="feedback" id="feedback-${index}"></div>
                `;
                
                container.appendChild(item);
            });
        }

        function checkConnection(index) {
            const exercise = connectionExercises[index];
            const serviceSelect = document.querySelector(`select[data-index="${index}"][data-type="service"]`);
            const pillarSelect = document.querySelector(`select[data-index="${index}"][data-type="pillar"]`);
            const feedback = document.getElementById('feedback-' + index);
            const item = document.getElementById('connection-' + index);
            
            if (serviceSelect.value && pillarSelect.value) {
                const serviceCorrect = serviceSelect.value === exercise.correctService;
                const pillarCorrect = pillarSelect.value === exercise.correctPillar;
                
                if (serviceCorrect && pillarCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.textContent = '✅ Perfetto! Hai fatto il collegamento corretto!';
                    item.classList.add('completed');
                } else {
                    feedback.className = 'feedback incorrect';
                    let message = '❌ Non è corretto. ';
                    if (!serviceCorrect) message += 'Rifletti sul servizio. ';
                    if (!pillarCorrect) message += 'Rifletti sul pilastro. ';
                    feedback.textContent = message;
                    item.classList.remove('completed');
                }
                saveData();
            }
        }

        // ========== QUIZ MODELLI ==========
        function checkQuizModello(quizNum, answer) {
            const feedback = document.getElementById('feedback-modello' + quizNum);
            const correct = {
                1: 'B', // Universale
                2: 'A', // Selettivo
                3: 'A'  // Selettivo
            };
            
            if (answer === correct[quizNum]) {
                feedback.className = 'feedback correct';
                feedback.textContent = '✅ Corretto!';
            } else {
                feedback.className = 'feedback incorrect';
                feedback.textContent = '❌ Non è corretto. Rifletti sulle caratteristiche dei modelli.';
            }
            saveData();
        }

        // ========== TABELLA LAVORO ==========
        function addWorkRow() {
            const tbody = document.getElementById('work-tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td data-label="Servizio">
                    <input type="text" class="work-input" data-field="servizio" placeholder="Nome del servizio...">
                </td>
                <td data-label="Bisogno Maslow">
                    <select class="work-input" data-field="bisogno_maslow">
                        <option value="">Seleziona...</option>
                        <option value="Fisiologici">1. Fisiologici</option>
                        <option value="Sicurezza">2. Sicurezza</option>
                        <option value="Appartenenza">3. Appartenenza</option>
                        <option value="Stima">4. Stima</option>
                        <option value="Conoscenza">5. Conoscenza</option>
                        <option value="Estetici">6. Estetici</option>
                        <option value="Auto-realizzazione">7. Auto-realizzazione</option>
                        <option value="Trascendenza">8. Trascendenza</option>
                    </select>
                </td>
                <td data-label="Pilastro">
                    <select class="work-input" data-field="pilastro">
                        <option value="">Seleziona...</option>
                        <option value="Sanità">🏥 Sanità</option>
                        <option value="Previdenza">💰 Previdenza</option>
                        <option value="Assistenza">🤝 Assistenza Sociale</option>
                    </select>
                </td>
                <td data-label="Beneficiari">
                    <textarea class="work-input" data-field="beneficiari" placeholder="Chi ne beneficia..."></textarea>
                </td>
                <td data-label="Perché essenziale">
                    <textarea class="work-input" data-field="essenziale" placeholder="Perché è essenziale..."></textarea>
                </td>
            `;
            tbody.appendChild(newRow);
            attachInputListeners();
            saveData();
        }

        // ========== SALVATAGGIO ==========
        function saveData() {
            const data = {
                phase: currentPhase,
                phase1: {
                    studentName: document.getElementById('student-name-p1')?.value || '',
                    studentClass: document.getElementById('student-class-p1')?.value || '',
                    date: document.getElementById('activity-date-p1')?.value || '',
                    brainstorm: document.getElementById('brainstorm-welfare')?.value || '',
                    competenzeAutoval: document.getElementById('competenze-autoval')?.value || '',
                    diamondExample: document.getElementById('diamond-example')?.value || '',
                    conceptMapInitial: document.getElementById('concept-map-initial')?.value || ''
                },
                phase2: {
                    enteEx1: document.getElementById('ente-ex1')?.value || '',
                    enteEx2: document.getElementById('ente-ex2')?.value || '',
                    enteEx3: document.getElementById('ente-ex3')?.value || '',
                    scenario1Needs: document.getElementById('scenario1-needs')?.value || '',
                    scenario1Services: document.getElementById('scenario1-services')?.value || '',
                    scenario2Needs: document.getElementById('scenario2-needs')?.value || '',
                    scenario2Services: document.getElementById('scenario2-services')?.value || ''
                },
                phase3: {
                    groupMembers: document.getElementById('group-members')?.value || '',
                    groupClass: document.getElementById('group-class')?.value || '',
                    groupDate: document.getElementById('group-date')?.value || '',
                    modelloRiflessione: document.getElementById('modello-riflessione')?.value || '',
                    presentationNotes: document.getElementById('presentation-notes')?.value || '',
                    workTable: [],
                    connections: [],
                    quizModello: {
                        q1: document.querySelector('input[name="quiz-modello1"]:checked')?.value || '',
                        q2: document.querySelector('input[name="quiz-modello2"]:checked')?.value || '',
                        q3: document.querySelector('input[name="quiz-modello3"]:checked')?.value || ''
                    }
                },
                phase4: {
                    studentName: document.getElementById('reflection-name')?.value || '',
                    studentClass: document.getElementById('reflection-class')?.value || '',
                    date: document.getElementById('reflection-date')?.value || '',
                    learned1: document.getElementById('learned1')?.value || '',
                    learned2: document.getElementById('learned2')?.value || '',
                    learned3: document.getElementById('learned3')?.value || '',
                    misconception: document.getElementById('misconception')?.value || '',
                    maslowDifficulty: document.getElementById('maslow-difficulty')?.value || '',
                    operatorExample: document.getElementById('operator-example')?.value || '',
                    networkCollaboration: document.getElementById('network-collaboration')?.value || '',
                    competenzaSviluppare: document.getElementById('competenza-sviluppare')?.value || '',
                    participation: document.querySelector('input[name="participation"]:checked')?.value || '',
                    helpfulAspect: document.getElementById('helpful-aspect')?.value || '',
                    conceptMapFinal: document.getElementById('concept-map-final')?.value || '',
                    projectSituation: document.getElementById('project-situation')?.value || '',
                    projectNeeds: document.getElementById('project-needs')?.value || '',
                    projectServices: document.getElementById('project-services')?.value || '',
                    projectActions: document.getElementById('project-actions')?.value || '',
                    projectNetworks: document.getElementById('project-networks')?.value || '',
                    competenze: {
                        pilastri: document.getElementById('comp-pilastri')?.checked || false,
                        maslow: document.getElementById('comp-maslow')?.checked || false,
                        enti: document.getElementById('comp-enti')?.checked || false,
                        leggi: document.getElementById('comp-leggi')?.checked || false,
                        modelli: document.getElementById('comp-modelli')?.checked || false,
                        collegamenti: document.getElementById('comp-collegamenti')?.checked || false,
                        analisi: document.getElementById('comp-analisi')?.checked || false,
                        strumenti: document.getElementById('comp-strumenti')?.checked || false,
                        progetto: document.getElementById('comp-progetto')?.checked || false,
                        empatia: document.getElementById('comp-empatia')?.checked || false,
                        ascolto: document.getElementById('comp-ascolto')?.checked || false,
                        etica: document.getElementById('comp-etica')?.checked || false,
                        riflessione: document.getElementById('comp-riflessione')?.checked || false
                    }
                }
            };

            // Salva tabella lavoro
            document.querySelectorAll('#work-tbody tr').forEach(row => {
                const rowData = {};
                row.querySelectorAll('.work-input').forEach(input => {
                    rowData[input.dataset.field] = input.value;
                });
                data.phase3.workTable.push(rowData);
            });

            // Salva collegamenti
            connectionExercises.forEach((exercise, index) => {
                const serviceSelect = document.querySelector(`select[data-index="${index}"][data-type="service"]`);
                const pillarSelect = document.querySelector(`select[data-index="${index}"][data-type="pillar"]`);
                if (serviceSelect && pillarSelect) {
                    data.phase3.connections.push({
                        service: serviceSelect.value,
                        pillar: pillarSelect.value
                    });
                }
            });

            localStorage.setItem('welfareActivity4FasiCompleto', JSON.stringify(data));
            showSaveStatus();
        }

        function loadData() {
            const saved = localStorage.getItem('welfareActivity4FasiCompleto');
            if (!saved) return;

            const data = JSON.parse(saved);

            // Carica fase corrente
            if (data.phase) {
                goToPhase(data.phase);
            }

            // Carica Fase 1
            if (data.phase1) {
                if (document.getElementById('student-name-p1')) document.getElementById('student-name-p1').value = data.phase1.studentName;
                if (document.getElementById('student-class-p1')) document.getElementById('student-class-p1').value = data.phase1.studentClass;
                if (document.getElementById('activity-date-p1')) document.getElementById('activity-date-p1').value = data.phase1.date;
                if (document.getElementById('brainstorm-welfare')) document.getElementById('brainstorm-welfare').value = data.phase1.brainstorm;
                if (document.getElementById('competenze-autoval')) document.getElementById('competenze-autoval').value = data.phase1.competenzeAutoval;
                if (document.getElementById('diamond-example')) document.getElementById('diamond-example').value = data.phase1.diamondExample;
                if (document.getElementById('concept-map-initial')) document.getElementById('concept-map-initial').value = data.phase1.conceptMapInitial;
            }

            // Carica Fase 2
            if (data.phase2) {
                if (document.getElementById('ente-ex1')) document.getElementById('ente-ex1').value = data.phase2.enteEx1;
                if (document.getElementById('ente-ex2')) document.getElementById('ente-ex2').value = data.phase2.enteEx2;
                if (document.getElementById('ente-ex3')) document.getElementById('ente-ex3').value = data.phase2.enteEx3;
                if (document.getElementById('scenario1-needs')) document.getElementById('scenario1-needs').value = data.phase2.scenario1Needs;
                if (document.getElementById('scenario1-services')) document.getElementById('scenario1-services').value = data.phase2.scenario1Services;
                if (document.getElementById('scenario2-needs')) document.getElementById('scenario2-needs').value = data.phase2.scenario2Needs;
                if (document.getElementById('scenario2-services')) document.getElementById('scenario2-services').value = data.phase2.scenario2Services;
            }

            // Carica Fase 3
            if (data.phase3) {
                if (document.getElementById('group-members')) document.getElementById('group-members').value = data.phase3.groupMembers;
                if (document.getElementById('group-class')) document.getElementById('group-class').value = data.phase3.groupClass;
                if (document.getElementById('group-date')) document.getElementById('group-date').value = data.phase3.groupDate;
                if (document.getElementById('modello-riflessione')) document.getElementById('modello-riflessione').value = data.phase3.modelloRiflessione;
                if (document.getElementById('presentation-notes')) document.getElementById('presentation-notes').value = data.phase3.presentationNotes;

                // Carica quiz modelli
                if (data.phase3.quizModello) {
                    if (data.phase3.quizModello.q1) {
                        const radio1 = document.querySelector(`input[name="quiz-modello1"][value="${data.phase3.quizModello.q1}"]`);
                        if (radio1) {
                            radio1.checked = true;
                            checkQuizModello(1, data.phase3.quizModello.q1);
                        }
                    }
                    if (data.phase3.quizModello.q2) {
                        const radio2 = document.querySelector(`input[name="quiz-modello2"][value="${data.phase3.quizModello.q2}"]`);
                        if (radio2) {
                            radio2.checked = true;
                            checkQuizModello(2, data.phase3.quizModello.q2);
                        }
                    }
                    if (data.phase3.quizModello.q3) {
                        const radio3 = document.querySelector(`input[name="quiz-modello3"][value="${data.phase3.quizModello.q3}"]`);
                        if (radio3) {
                            radio3.checked = true;
                            checkQuizModello(3, data.phase3.quizModello.q3);
                        }
                    }
                }

                // Carica tabella
                if (data.phase3.workTable && data.phase3.workTable.length > 0) {
                    const tbody = document.getElementById('work-tbody');
                    tbody.innerHTML = '';
                    data.phase3.workTable.forEach(rowData => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td data-label="Servizio">
                                <input type="text" class="work-input" data-field="servizio" value="${rowData.servizio || ''}">
                            </td>
                            <td data-label="Bisogno Maslow">
                                <select class="work-input" data-field="bisogno_maslow">
                                    <option value="">Seleziona...</option>
                                    <option value="Fisiologici" ${rowData.bisogno_maslow === 'Fisiologici' ? 'selected' : ''}>1. Fisiologici</option>
                                    <option value="Sicurezza" ${rowData.bisogno_maslow === 'Sicurezza' ? 'selected' : ''}>2. Sicurezza</option>
                                    <option value="Appartenenza" ${rowData.bisogno_maslow === 'Appartenenza' ? 'selected' : ''}>3. Appartenenza</option>
                                    <option value="Stima" ${rowData.bisogno_maslow === 'Stima' ? 'selected' : ''}>4. Stima</option>
                                    <option value="Conoscenza" ${rowData.bisogno_maslow === 'Conoscenza' ? 'selected' : ''}>5. Conoscenza</option>
                                    <option value="Estetici" ${rowData.bisogno_maslow === 'Estetici' ? 'selected' : ''}>6. Estetici</option>
                                    <option value="Auto-realizzazione" ${rowData.bisogno_maslow === 'Auto-realizzazione' ? 'selected' : ''}>7. Auto-realizzazione</option>
                                    <option value="Trascendenza" ${rowData.bisogno_maslow === 'Trascendenza' ? 'selected' : ''}>8. Trascendenza</option>
                                </select>
                            </td>
                            <td data-label="Pilastro">
                                <select class="work-input" data-field="pilastro">
                                    <option value="">Seleziona...</option>
                                    <option value="Sanità" ${rowData.pilastro === 'Sanità' ? 'selected' : ''}>🏥 Sanità</option>
                                    <option value="Previdenza" ${rowData.pilastro === 'Previdenza' ? 'selected' : ''}>💰 Previdenza</option>
                                    <option value="Assistenza" ${rowData.pilastro === 'Assistenza' ? 'selected' : ''}>🤝 Assistenza Sociale</option>
                                </select>
                            </td>
                            <td data-label="Beneficiari">
                                <textarea class="work-input" data-field="beneficiari">${rowData.beneficiari || ''}</textarea>
                            </td>
                            <td data-label="Perché essenziale">
                                <textarea class="work-input" data-field="essenziale">${rowData.essenziale || ''}</textarea>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }

                // Carica collegamenti
                if (data.phase3.connections) {
                    data.phase3.connections.forEach((conn, index) => {
                        const serviceSelect = document.querySelector(`select[data-index="${index}"][data-type="service"]`);
                        const pillarSelect = document.querySelector(`select[data-index="${index}"][data-type="pillar"]`);
                        if (serviceSelect) serviceSelect.value = conn.service || '';
                        if (pillarSelect) pillarSelect.value = conn.pillar || '';
                        if (conn.service && conn.pillar) {
                            checkConnection(index);
                        }
                    });
                }
            }

            // Carica Fase 4
            if (data.phase4) {
                if (document.getElementById('reflection-name')) document.getElementById('reflection-name').value = data.phase4.studentName;
                if (document.getElementById('reflection-class')) document.getElementById('reflection-class').value = data.phase4.studentClass;
                if (document.getElementById('reflection-date')) document.getElementById('reflection-date').value = data.phase4.date;
                if (document.getElementById('learned1')) document.getElementById('learned1').value = data.phase4.learned1;
                if (document.getElementById('learned2')) document.getElementById('learned2').value = data.phase4.learned2;
                if (document.getElementById('learned3')) document.getElementById('learned3').value = data.phase4.learned3;
                if (document.getElementById('misconception')) document.getElementById('misconception').value = data.phase4.misconception;
                if (document.getElementById('maslow-difficulty')) document.getElementById('maslow-difficulty').value = data.phase4.maslowDifficulty;
                if (document.getElementById('operator-example')) document.getElementById('operator-example').value = data.phase4.operatorExample;
                if (document.getElementById('network-collaboration')) document.getElementById('network-collaboration').value = data.phase4.networkCollaboration;
                if (document.getElementById('competenza-sviluppare')) document.getElementById('competenza-sviluppare').value = data.phase4.competenzaSviluppare;
                if (document.getElementById('helpful-aspect')) document.getElementById('helpful-aspect').value = data.phase4.helpfulAspect;
                if (document.getElementById('concept-map-final')) document.getElementById('concept-map-final').value = data.phase4.conceptMapFinal;
                if (document.getElementById('project-situation')) document.getElementById('project-situation').value = data.phase4.projectSituation;
                if (document.getElementById('project-needs')) document.getElementById('project-needs').value = data.phase4.projectNeeds;
                if (document.getElementById('project-services')) document.getElementById('project-services').value = data.phase4.projectServices;
                if (document.getElementById('project-actions')) document.getElementById('project-actions').value = data.phase4.projectActions;
                if (document.getElementById('project-networks')) document.getElementById('project-networks').value = data.phase4.projectNetworks;
                
                if (data.phase4.participation) {
                    const radio = document.querySelector(`input[name="participation"][value="${data.phase4.participation}"]`);
                    if (radio) radio.checked = true;
                }

                // Carica competenze
                if (data.phase4.competenze) {
                    Object.keys(data.phase4.competenze).forEach(key => {
                        const checkbox = document.getElementById('comp-' + key);
                        if (checkbox) checkbox.checked = data.phase4.competenze[key];
                    });
                }
            }

            attachInputListeners();
        }

        function showSaveStatus() {
            const status = document.getElementById('save-status');
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 2000);
        }

        function attachInputListeners() {
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.removeEventListener('input', saveData);
                input.removeEventListener('change', saveData);
                input.addEventListener('input', saveData);
                input.addEventListener('change', saveData);
            });
        }

        // ========== STAMPA ==========
        function printWork() {
            saveData();
            const cleanup = enablePrintMode();
            let cleaned = false;

            const doCleanup = () => {
                if (cleaned) return;
                cleaned = true;
                cleanup();
            };

            const afterPrintHandler = () => {
                doCleanup();
                window.removeEventListener('afterprint', afterPrintHandler);
            };

            window.addEventListener('afterprint', afterPrintHandler);
            window.print();

            setTimeout(() => {
                doCleanup();
            }, 1500);
        }

        // ========== INIZIALIZZAZIONE ==========
        document.addEventListener('DOMContentLoaded', () => {
            initHeaderHideOnScroll();
            generateCards();
            generateConnectionExercises();
            loadData();
            attachInputListeners();
        });
    </script>
    <script>
        window.MO_PROGRESS_CONFIG = {
            pagePath: window.location.pathname,
            inputSelector: 'textarea, input:not([type="file"]), select, [contenteditable="true"]',
            onBeforeSave(data) {
                try {
                    saveData();
                    const raw = localStorage.getItem('welfareActivity4FasiCompleto');
                    if (raw) {
                        data._welfareState = JSON.parse(raw);
                    }
                } catch (error) {
                    console.error('Errore durante onBeforeSave welfare:', error);
                }
                return data;
            },
            onRestore(saved) {
                try {
                    const state = saved && (saved._welfareState || saved);
                    if (state) {
                        localStorage.setItem('welfareActivity4FasiCompleto', JSON.stringify(state));
                        loadData();
                    }
                } catch (error) {
                    console.error('Errore durante onRestore welfare:', error);
                }
            }
        };
    </script>
    <script type="module" src="../../assets/progress.js"></script>
    <script type="module" src="../../assets/progress-global.js"></script>
</body>
</html>
