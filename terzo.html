<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terzo Anno - Materiali Didattici</title>
    <meta name="description" content="Materiali didattici per il Terzo Anno - Metodologie Operative">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Materiali Didattici - Metodologie Operative</h1>
            <p>Servizi per la Sanit√† e l'Assistenza Sociale</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">IIS Meucci Mattei - Cagliari (Sede Decimomannu)</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="biennio.html">Biennio</a></li>
            <li><a href="terzo.html" class="active">Terzo Anno</a></li>
            <li><a href="quarto.html">Quarto Anno</a></li>
            <li><a href="quinto.html">Quinto Anno</a></li>
        </ul>
    </nav>

    <main>
        <div class="container">
            <div class="page-title">
                <h2>üìñ Materiali del Terzo Anno</h2>
                <p>Classe Terza</p>
            </div>

            <input name="prova" placeholder="Scrivi qui per test" />

            <div id="materiali-lista">
                <div class="loading">Caricamento materiali in corso...</div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p><strong>Prof. Dott. Picconi</strong></p>
            <p>Metodologie Operative - Servizi Sociosanitari</p>
            <p>IIS Meucci Mattei - Cagliari</p>
            <p style="margin-top: 1rem; font-size: 0.9rem;">&copy; 2025 - Tutti i diritti riservati</p>
            <div class="home-link">
                <a href="https://salvapicconi.github.io/metodologieoperative/">üè† Torna alla Home</a>
            </div>
        </div>
    </footer>

    <script src="materiali.js"></script>

    <!-- Libreria progressi -->
    <script type="module" src="assets/progress.js"></script>

    <!-- Integrazione e debug -->
    <script type="module">
      import { Progress } from './assets/progress.js';
      console.log('Progress loaded?', !!Progress);

      // Forza la richiesta di Classe/Codice al primo caricamento (solo per test)
      (async () => {
        try { await Progress.save({ _ping: Date.now() }); }
        catch (e) { console.warn('Ping save error (ok per test):', e); }
      })();

      function collectData() {
        const d = {};
        document.querySelectorAll('input, textarea, select').forEach(el => {
          if (el.name) d[el.name] = el.value;
        });
        return d;
      }

      function restoreData(s) {
        if (!s) return;
        for (const [k, v] of Object.entries(s)) {
          const el = document.querySelector(`[name="${k}"]`);
          if (el) el.value = v;
        }
      }

      // Carica all‚Äôavvio
      (async () => {
        try {
          const saved = await Progress.load();
          restoreData(saved);
        } catch (e) {
          console.error('Load error:', e);
        }
      })();

      // Salva al click
      document.addEventListener('click', async (e) => {
        if (e.target.matches('#saveProgressBtn')) {
          console.log('Save button clicked');
          e.target.textContent = '‚è≥ Salvataggio...';
          try {
            await Progress.save(collectData());
            alert('Progressi salvati!');
          } catch (err) {
            console.error('Save error:', err);
            alert('Errore salvataggio (vedi Console).');
          } finally {
            e.target.textContent = 'üíæ Salva progressi';
          }
        }
      });
    </script>

    <!-- Pulsante visibile per il salvataggio -->
    <button id="saveProgressBtn" data-save-progress
      style="position:fixed;right:16px;bottom:16px;padding:10px 14px;border-radius:10px;border:0;background:#0ea5e9;color:#fff;box-shadow:0 6px 14px rgba(0,0,0,.15);z-index:99999;cursor:pointer;">
      üíæ Salva progressi
    </button>
</body>
</html>
